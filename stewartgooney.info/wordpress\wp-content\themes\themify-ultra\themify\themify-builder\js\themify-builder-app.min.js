var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(f,z,b){f instanceof String&&(f=String(f));for(var q=f.length,a=0;a<q;a++){var c=f[a];if(z.call(b,c,a,f))return{i:a,v:c}}return{i:-1,v:void 0}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(f,z,b){f!=Array.prototype&&f!=Object.prototype&&(f[z]=b.value)};$jscomp.getGlobal=function(f){return"undefined"!=typeof window&&window===f?f:"undefined"!=typeof global&&null!=global?global:f};
$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(f,z,b,q){if(z){b=$jscomp.global;f=f.split(".");for(q=0;q<f.length-1;q++){var a=f[q];a in b||(b[a]={});b=b[a]}f=f[f.length-1];q=b[f];z=z(q);z!=q&&null!=z&&$jscomp.defineProperty(b,f,{configurable:!0,writable:!0,value:z})}};$jscomp.polyfill("Array.prototype.find",function(f){return f?f:function(f,b){return $jscomp.findInternal(this,f,b).v}},"es6-impl","es3");$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(f){return $jscomp.SYMBOL_PREFIX+(f||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var f=$jscomp.global.Symbol.iterator;f||(f=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[f]&&$jscomp.defineProperty(Array.prototype,f,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(f){var z=0;return $jscomp.iteratorPrototype(function(){return z<f.length?{done:!1,value:f[z++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(f){$jscomp.initSymbolIterator();f={next:f};f[$jscomp.global.Symbol.iterator]=function(){return this};return f};$jscomp.iteratorFromArray=function(f,z){$jscomp.initSymbolIterator();f instanceof String&&(f+="");var b=0,q={next:function(){if(b<f.length){var a=b++;return{value:z(a,f[a]),done:!1}}q.next=function(){return{done:!0,value:void 0}};return q.next()}};q[Symbol.iterator]=function(){return q};return q};
$jscomp.polyfill("Array.prototype.keys",function(f){return f?f:function(){return $jscomp.iteratorFromArray(this,function(f){return f})}},"es6-impl","es3");window.themifybuilderapp=window.themifybuilderapp||{};
(function(f){var z=f.ui.sortable.prototype._mouseStart;f.ui.sortable.prototype._mouseStart=function(a,c,b){this._trigger("beforeStart",a,this._uiHash());z.apply(this,[a,c,b])};void 0===f.fn.themifySerializeObject&&(f.fn.themifySerializeObject=function(){for(var a={},c=0,b=this.length;c<b;++c){var g=this[c].type;if(f(this[c]).hasClass("wp-editor-area")&&void 0!==tinyMCE){var e=tinyMCE.get(this[c].id);e&&(this[c].value=e.getContent())}if(""!==this[c].value&&this[c].name&&("text"===g||"radio"===g||"checkbox"===
g||"textarea"===g||"select-one"===g||"hidden"===g||"email"===g)){var e=this[c].name,k=this[c].value;if("radio"===g||"checkbox"===g)k=this[c].checked&&k;void 0!==a[e]?(!a[e].push&&(a[e]=[a[e]]),k&&a[e].push(k)):k&&(a[e]=k)}}return a});var b=themifybuilderapp={activeModel:null,Models:{},Collections:{},Mixins:{},Views:{Modules:{},Rows:{},SubRows:{},Columns:{},Controls:{}},Forms:{},Utils:{},Instances:{Builder:{}},cache:{repeaterElements:{}}},q=[];b.editing=!1;b.init=!1;b.scrollTo=!1;b.eventName=!1;b.beforeEvent=
!1;b.saving=!1;b.rowStyling=[];b.saveCid=!1;b.activeBreakPoint="desktop";b.zoomMeta={isActive:!1,size:100};b.isPreview=!1;b.isComponentSaved=[];b.Models.Module=Backbone.Model.extend({defaults:{elType:"module",mod_name:"",mod_settings:{}},initialize:function(){b.Models.Registry.register(this.cid,this)},toRenderData:function(){return{slug:this.get("mod_name"),name:this.get("mod_name"),excerpt:this.getExcerpt()}},getExcerpt:function(a){a=a||this.get("mod_settings");return this.limitString(a.content_text||
a.content_box||a.plain_text||"",100)},limitString:function(a,c){var b="";""!==a&&(a=this.stripHtml(a).toString(),b=a.length>c?a.substr(0,c):a);return b},stripHtml:function(a){var c=document.createElement("div");c.innerHTML=a;return c.textContent||c.innerText||""},setData:function(a){a=b.Views.init_module(a,b.mode);a.model.trigger("custom:change",a)},backendLivePreview:function(){f(".tb_element_cid_"+this.cid).find(".module_excerpt").text(this.getExcerpt(q))},getPreviewSettings:function(){return _.extend({cid:this.cid},
themifyBuilder.modules[this.get("mod_name")].defaults,q)}});b.Models.SubRow=Backbone.Model.extend({defaults:{elType:"subrow",row_order:0,gutter:"gutter-default",column_alignment:"col_align_top",background_video:"",mutevideo:"",unloopvideo:"",desktop_dir:"ltr",tablet_dir:"ltr",mobile_dir:"ltr",col_mobile:"-auto",col_tablet:"-auto",cols:{},styling:{}},initialize:function(){b.Models.Registry.register(this.cid,this)},setData:function(a){a=b.Views.init_subrow(a,b.mode);a.model.trigger("custom:change",
a)}});b.Models.Column=Backbone.Model.extend({defaults:{elType:"column",column_order:"",grid_class:"",component_name:"column",background_video:"",mutevideo:"",unloopvideo:"",modules:{},styling:{}},initialize:function(){b.Models.Registry.register(this.cid,this)},setData:function(a){a=b.Views.init_column(a,b.mode);a.model.trigger("custom:change",a)}});b.Models.Row=Backbone.Model.extend({defaults:{elType:"row",row_order:0,gutter:"gutter-default",column_alignment:"col_align_top",desktop_dir:"ltr",tablet_dir:"ltr",
mobile_dir:"ltr",col_mobile:"-auto",col_tablet:"-auto",background_video:"",mutevideo:"",unloopvideo:"",cols:{},styling:{}},initialize:function(){b.Models.Registry.register(this.cid,this)},setData:function(a){a=b.Views.init_row(a,b.mode);a.model.trigger("custom:change",a)}});b.Collections.Rows=Backbone.Collection.extend({model:b.Models.Row});b.Models.Registry={items:{},register:function(a,c){this.items[a]=c},lookup:function(a){return this.items[a]||null},remove:function(a){delete this.items[a]},destroy:function(){_.each(this.items,
function(a,c){a.destroy()});this.items={};console.log("destroy registry")}};b.Models.setValue=function(a,c,d){d=d||!1;b.Models.Registry.lookup(a).set(c,{silent:d})};b.vent=_.extend({},Backbone.Events);b.Views.register_module=function(a,c){"default"!==a&&(this.Modules[a]=this.Modules["default"].extend(c))};b.Views.init_module=function(a,c){if(void 0===themifyBuilder.modules[a.mod_name])return!1;c=c||"default";void 0===a.mod_settings&&void 0!==themifyBuilder.modules[a.mod_name].defaults&&(a.mod_settings=
_.extend({},themifyBuilder.modules[a.mod_name].defaults));var d=a instanceof b.Models.Module?a:new b.Models.Module(a),g=new (this.get_module(c))({model:d,type:c});return{model:d,view:g}};b.Views.get_module=function(a){a=a||"default";return this.module_exists(a)?this.Modules[a]:this.Modules["default"]};b.Views.unregister_module=function(a){"default"!==a&&this.module_exists(a)&&delete this.Modules[a]};b.Views.module_exists=function(a){return this.Modules.hasOwnProperty(a)};b.Views.register_column=function(a,
c){"default"!==a&&(this.Columns[a]=this.Columns["default"].extend(c))};b.Views.init_column=function(a,c){c=c||"default";var d=a instanceof b.Models.Column?a:new b.Models.Column(a),g=new (this.get_column(c))({model:d,type:c});return{model:d,view:g}};b.Views.get_column=function(a){a=a||"default";return this.column_exists(a)?this.Columns[a]:this.Columns["default"]};b.Views.unregister_column=function(a){"default"!==a&&this.column_exists(a)&&delete this.Columns[a]};b.Views.column_exists=function(a){return this.Columns.hasOwnProperty(a)};
b.Views.register_subrow=function(a,c){"default"!==a&&(this.SubRows[a]=this.SubRows["default"].extend(c))};b.Views.init_subrow=function(a,c){c=c||"default";var d=a instanceof b.Models.SubRow?a:new b.Models.SubRow(a),g=new (this.get_subrow(c))({model:d,type:c});return{model:d,view:g}};b.Views.get_subrow=function(a){a=a||"default";return this.subrow_exists(a)?this.SubRows[a]:this.SubRows["default"]};b.Views.unregister_subrow=function(a){"default"!==a&&this.subrow_exists(a)&&delete this.SubRows[a]};b.Views.subrow_exists=
function(a){return this.SubRows.hasOwnProperty(a)};b.Views.register_row=function(a,c){"default"!==a&&(this.Rows[a]=this.Rows["default"].extend(c))};b.Views.init_row=function(a,c){var d=a.attributes;if(void 0===d||void 0!==d.cols&&(0<Object.keys(d.cols)||0<d.cols.length)||void 0!==d.styling&&0<Object.keys(d.styling).length){c=c||"default";var d=a instanceof b.Models.Row?a:new b.Models.Row(a),g=new (this.get_row(c))({model:d,type:c});return{model:d,view:g}}return!1};b.Views.get_row=function(a){a=a||
"default";return this.row_exists(a)?this.Rows[a]:this.Rows["default"]};b.Views.unregister_row=function(a){"default"!==a&&this.row_exists(a)&&delete this.Rows[a]};b.Views.row_exists=function(a){return this.Rows.hasOwnProperty(a)};b.Views.BaseElement=Backbone.View.extend({type:"default",events:{"click .themify_builder_copy_component":"copy","click .themify_builder_paste_component":"paste","click .themify_builder_import_component":"import","click .themify_builder_export_component":"export","click .themify_duplicate":"duplicate",
"click .themify_delete":"delete"},initialize:function(a){_.extend(this,_.pick(a,"type"));this.listenTo(this.model,"custom:change",this.modelChange);this.listenTo(this.model,"destroy",this.remove)},modelChange:function(){this.$el.attr(_.extend({},_.result(this,"attributes")));var a=this.render(),c=this.model.get("elType"),d=b.beforeEvent.data("cid");f(".tb_element_cid_"+d).replaceWith(a.el);"visual"===b.mode?("subrow"!==c&&b.Mixins.Builder.initGridMenu(a.el,"module"!==c),this.model.trigger("visual:change")):
("row"===b.eventName&&(d=this.$el.data("cid")),b.vent.trigger("dom:change",d,b.beforeEvent,this.$el,b.eventName),b.Mixins.Builder.update(this.$el),"row"===b.eventName&&b.vent.trigger("dom:builder:change"))},remove:function(){this.$el.remove()},copy:function(a){a.preventDefault();a.stopPropagation();var c=f(a.currentTarget);a=ThemifyBuilderCommon.detectBuilderComponent(c);switch(a){case "row":case "subrow":var b=c.closest(".module_"+a);break;case "module":b=c.closest(".active_module");break;case "column":case "sub-column":b=
c.closest(".module_column")}b=this.getData(b,a);"sub-column"===a&&(b.component_name=a);ThemifyBuilderCommon.Clipboard.set(a,b)},paste:function(a){a.preventDefault();a.stopPropagation();var c=f(a.currentTarget),d=ThemifyBuilderCommon.detectBuilderComponent(c);a=ThemifyBuilderCommon.Clipboard.get(d);if(!1===a)ThemifyBuilderCommon.alertWrongPaste();else if(ThemifyBuilderCommon.confirmDataPaste()){var c=c.closest("[data-cid]"),g=b.Models.Registry.lookup(c.data("cid"));b.eventName="row";if("column"===
d||"sub-column"===d)a.grid_class=b.Utils.filterClass(c.prop("class")),c.hasClass("first")?a.grid_class+=" first":c.hasClass("last")&&(a.grid_class+=" last"),(d=c[0].style.width)?a.grid_width=d.replace("%",""):delete a.grid_width;b.beforeEvent=ThemifyBuilderCommon.Lightbox.clone(c);g.setData(a)}},"import":function(a){a.preventDefault();a.stopPropagation();a=f(a.currentTarget);var c=ThemifyBuilderCommon.detectBuilderComponent(a),d=a.closest("[data-cid]"),g=b.Models.Registry.lookup(d.data("cid")),e=
{data:{action:"tb_component_data",component:c,type:"import"}};if("column"===c||"sub-column"===c){var k=a.closest(".module_column");var h=k.closest("column"===c?".module_row":".module_subrow").index();e.data.indexData={row:h,col:k.index()}}ThemifyBuilderCommon.Lightbox.open(e,null,function(){var a=this.$lightbox;a.find("#builder_submit_import_component_form").on("click",function(e){e.preventDefault();e=a.find("#tb_data_field");e=JSON.parse(e.val());if("column"===c&&"sub-column"===e.component_name||
"sub-column"===c&&"column"===e.component_name)e.component_name=c;if(void 0===e.component_name||e.component_name!==c)ThemifyBuilderCommon.alertWrongPaste();else{e=b.Utils.clear(e,!0);if("column"===c||"sub-column"===c)e.column_order=k.index(),e.grid_class=k.prop("class"),"column"===c?e.row_order=h:(e.sub_row_order=h,e.row_order=k.closest(".module_row").index(),e.col_order=k.parents(".module_column").index());b.eventName="row";b.beforeEvent=ThemifyBuilderCommon.Lightbox.clone(d);g.setData(e);ThemifyBuilderCommon.Lightbox.close()}})})},
getData:function(a,c){var d={};var g=c||ThemifyBuilderCommon.detectBuilderComponent(a);switch(g){case "row":case "subrow":var e=a.closest(".module_"+g);var f=e.index();d=b.Utils._getRowSettings(e[0],f,g);break;case "module":d=b.Models.Registry.lookup(a.closest(".active_module").data("cid")).attributes;d=b.Utils.clear(d,!0);break;case "column":case "sub-column":d=a.closest(".module_column"),e=d.closest("column"===g?".module_row":".module_subrow"),f=e.index(),g=b.Utils._getRowSettings(e[0],f,"column"===
g?"row":"subrow"),d=g.cols[d.index()]}return d},"export":function(a){a.preventDefault();a.stopPropagation();var c=f(a.currentTarget);a=ThemifyBuilderCommon.detectBuilderComponent(c);var b=this.getData(c,a),c={data:{action:"tb_component_data",component:a,type:"export"}};b.component_name=a;b=JSON.stringify(b);ThemifyBuilderCommon.Lightbox.open(c,null,function(){this.$lightbox.find("#tb_data_field").val(b).on("click",function(){f(this).trigger("focus").trigger("select")})})},duplicate:function(a){a.preventDefault();
a.stopPropagation();a=f(a.currentTarget).closest("[data-cid]");var c=ThemifyBuilderCommon.Lightbox.clone(a),d=b.Models.Registry.lookup(c.data("cid"));a.removeClass("tb_element_cid_"+d.cid);c.hide().insertAfter(a);var g=this.getData(c,d.get("elType"));b.eventName="duplicate";b.beforeEvent=c;d.setData(g);a.addClass("tb_element_cid_"+d.cid)},editComponent:function(){var a=b.activeModel.get("elType"),c="module"===a?b.activeModel.get("mod_name"):a;ThemifyBuilderCommon.Lightbox.open({loadMethod:"inline",
templateID:"builder_form_"+c},function(c){b.Mixins.Common.editComponentCallback(c,a,!1,!1)},function(c){c=ThemifyBuilderCommon.Lightbox.$lightbox;b.activeModel.get("styleClicked")?c.find('a[href="#themify_builder_options_styling"]').trigger("click"):b.activeModel.get("visibileClicked")?c.find('a[href="#themify_builder_options_visibility"]').trigger("click"):new SimpleBar(c.find("#"+("column"===a||"subrow"===a?"themify_builder_options_styling":"themify_builder_options_setting"))[0])})},"delete":function(a){a.preventDefault();
a.stopPropagation();a=f(a.currentTarget);var c=ThemifyBuilderCommon.detectBuilderComponent(a);if(confirm(themifyBuilder.i18n[c+"DeleteConfirm"])){var d=a.closest("[data-cid]");a=d.data("cid");if(c=b.Models.Registry.lookup(a)){var d=d.closest(".module_row"),g="row",e="",k={};"row"===c.get("elType")?(k.pos_cid=d.next(".module_row"),k.pos="before",0===k.pos_cid.length&&(k.pos="after",k.pos_cid=d.prev(".module_row")),g="delete_row",k.pos_cid=k.pos_cid.data("cid")):a=d.data("cid");d=ThemifyBuilderCommon.Lightbox.clone(d);
c.destroy();"row"!==c.get("elType")?e=f(".tb_element_cid_"+a):b.vent.trigger("dom:builder:change");b.vent.trigger("dom:change",a,d,e,g,k)}}}});b.Views.BaseElement.extend=function(a){var c=this,b=Backbone.View.extend.apply(this,arguments);b.prototype.events=_.extend({},this.prototype.events,a.events);b.prototype.initialize=function(){_.isFunction(c.prototype.initialize)&&c.prototype.initialize.apply(this,arguments);_.isFunction(a.initialize)&&a.initialize.apply(this,arguments)};return b};b.Views.Modules["default"]=
b.Views.BaseElement.extend({tagName:"div",attributes:function(){return{"class":"themify_builder_module module-"+this.model.get("mod_name")+" active_module tb_element_cid_"+this.model.cid,"data-cid":this.model.cid}},template:wp.template("builder_module_item"),events:{dblclick:"edit","click .themify_module_options":"edit","click .themify_builder_module_styling":"edit","click .tb_visibility_component ":"edit"},initialize:function(){this.listenTo(this,"edit",this.edit);this.listenTo(this.model,"dom:module:unsaved",
this.removeUnsaved);this.listenTo(this.model,"change:view",this.setView)},removeUnsaved:function(){this.model.destroy()},render:function(){this.el.innerHTML=this.template(this.model.toRenderData());return this},setView:function(a){this.setElement(a)},edit:function(a){if(b.isPreview)return!0;null!==a&&(a.preventDefault(),a.stopPropagation(),a.currentTarget.classList.contains("themify_builder_module_styling")?this.model.set({styleClicked:!0},{silent:!0}):a.currentTarget.classList.contains("tb_visibility_component")&&
this.model.set({visibileClicked:!0},{silent:!0}));b.activeModel=this.model;this.editComponent()}});b.Views.Columns["default"]=b.Views.BaseElement.extend({tagName:"div",attributes:function(){var a="column"===this.model.get("component_name")?"":" sub_column",a={"class":"module_column tb-column tb_element_cid_"+this.model.cid+" "+this.model.get("grid_class")+a,"data-cid":this.model.cid};this.model.get("grid_width")&&(a.style="width:"+this.model.get("grid_width")+"%");return a},template:wp.template("builder_column_item"),
events:{"click .themify_builder_option_column":"edit","click .js-tb_empty_row_btn":"showModPanel"},initialize:function(){this.listenTo(this.model,"change:view",this.setView)},render:function(a){this.el.innerHTML=this.template({component_name:this.model.get("component_name")});var c=this.model.get("modules"),d=Object.keys(c).length;!b.id&&b.saveCid&&(b.rowStyling[this.model.cid]=1);if(0<d){for(var g=document.createDocumentFragment(),e=0;e<=d;++e)if(void 0!==c[e]&&null!==c[e]){var f=a?a+"-"+e:!1,h=
void 0===c[e].cols?b.Views.init_module(c[e],this.type):b.Views.init_subrow(c[e],this.type);if(h){var l=h.view.render(f);b.id&&c[e].mod_name?(b.VisualCache[h.model.cid]=c[e].mod_name+"-"+b.id+"-"+f,l.$el.children(".module")[0].className+=" "+b.VisualCache[h.model.cid]):!b.id&&b.saveCid&&(b.rowStyling[h.model.cid]=1);g.appendChild(l.el)}}this.el.getElementsByClassName("themify_module_holder")[0].appendChild(g)}return this},edit:function(a){a.preventDefault();a.stopPropagation();b.activeModel=this.model;
this.editComponent()},setView:function(a){this.setElement(a)},showModPanel:function(a){a.preventDefault();b.toolbar.Panel.show()}});b.Views.SubRows["default"]=b.Views.BaseElement.extend({tagName:"div",attributes:function(){return{"class":"themify_builder_sub_row module_subrow active_module clearfix tb_element_cid_"+this.model.cid,"data-cid":this.model.cid}},template:wp.template("builder_subrow_item"),events:{"click .themify_builder_style_subrow":"edit"},initialize:function(){this.listenTo(this.model,
"change:view",this.setView)},render:function(a){var c=this.model.get("cols"),d=Object.keys(c).length;this.el.innerHTML=this.template();b.id&&(b.VisualCache[this.model.cid]="sub_row_"+a,this.el.className+=" "+b.VisualCache[this.model.cid]);if(0<d){for(var g=document.createDocumentFragment(),e=0;e<=d;++e)if(void 0!==c[e]){c[e].component_name="sub-column";var f=a+"-"+e,h=b.Views.init_column(c[e],this.type),l=h.view.render("sub_row_"+f).el;b.id&&(b.VisualCache[h.model.cid]="sub_column_post_"+b.id+" sub_column_"+
f,l.className+=" "+b.VisualCache[h.model.cid]);g.appendChild(l)}this.el.getElementsByClassName("subrow_inner")[0].appendChild(g)}b.init&&!b.id&&b.Utils.selectedGridMenu(this.el);return this},setView:function(a){this.setElement(a)},edit:function(a){a.stopPropagation();a.preventDefault();b.activeModel=this.model;this.editComponent()}});b.Views.Rows["default"]=b.Views.BaseElement.extend({tagName:"div",attributes:function(){return{"class":"themify_builder_row module_row clearfix tb_element_cid_"+this.model.cid,
"data-cid":this.model.cid}},template:wp.template("builder_row_item"),events:{"click .themify_builder_option_row":"edit","click .themify_builder_style_row":"edit","click .tb_visibility_component ":"edit","click .themify_builder_grid_list li a":"_gridMenuClicked","click .themify_builder_grid_list_wrapper .grid_tabs li a":"_switchGridTabs","click .themify_builder_column_alignment li a":"_columnAlignmentMenuClicked","click .themify_builder_column_direction li a":"_columnDirectionMenuClicked","change .gutter_select":"_gutterChange",
"click .toggle_row":"toggleRow","click .themify_builder_toggle_row":"toggleRow"},initialize:function(){this.listenTo(this.model,"change:view",this.setView)},render:function(a){var c=this.model.get("cols"),d=Object.keys(c).length;this.el.innerHTML=this.template();b.saveCid&&(b.rowStyling[this.model.cid]=1);if(0<d){for(var g=document.createDocumentFragment(),e,f=!1,h=0;h<=d;++h)if(void 0!==c[h]){c[h].component_name="column";var l=b.Views.init_column(c[h],this.type);b.id&&(e=l.model.get("column_order"),
void 0===e&&(e=h),f=a+"-"+e);var n=l.view.render(f).el;b.id&&(b.VisualCache[l.model.cid]="module_column_"+e+" tb_"+b.id+"_column",n.className+=" "+b.VisualCache[l.model.cid]);g.appendChild(n)}this.el.getElementsByClassName("row_inner")[0].appendChild(g)}else b.Utils._addNewColumn({newclass:"col-full",component:"column",type:this.type},this.$el.find(".row_inner"));b.Utils.selectedGridMenu(this.el);return this},edit:function(a){a.stopPropagation();a.preventDefault();a.currentTarget.classList.contains("themify_builder_style_row")?
this.model.set({styleClicked:!0},{silent:!0}):a.currentTarget.classList.contains("tb_visibility_component")&&this.model.set({visibileClicked:!0},{silent:!0});b.activeModel=this.model;this.editComponent()},_switchGridTabs:function(a){b.scrollTo=f(a.currentTarget).closest("[data-cid]");b.Forms.lightbox_switcher(a)},_gridMenuClicked:function(a){a.preventDefault();a=f(a.currentTarget);var c=a.data("grid"),d=a.data("handle"),g=!1,e=a.data("type"),k="desktop"===e,h=ThemifyBuilderCommon.Lightbox.clone(a.closest(".module_row"));
a.parent().addClass("selected").siblings().removeClass("selected");if("module"===d){if("-full"!==c[0]){g=!0;var l=b.Views.init_subrow({cols:[{grid_class:"col-full"}]},b.mode);var n=a.closest(".active_module"),t=n.clone();t.insertAfter(n);var m=l.view.render().$el.find(".themify_module_holder").prepend(n).end().insertAfter(t).find("."+a.attr("class").replace(" ",".")).closest("li").addClass("selected").siblings().removeClass("selected").end().end().end().find(".subrow_inner");t.remove();l=m.closest(".module_subrow")}}else g=
"subrow"===d,l=a.closest(".module_"+d),m=l.find("."+d+"_inner").first();if(0!==m.length){if(k||"module"===d){e=m;var w=a.data("col");e=e.add(l);void 0===w&&(w=1,a.data("col",w));e.removeClass("col-count-1 col-count-"+m.attr("data-basecol")).addClass("col-count-"+w);m.attr("data-basecol",w);k&&a.closest(".themify_builder_grid_list_wrapper").find(".themify_builder_grid_reposnive .themify_builder_grid_list").each(function(){var a=f(this).find(".selected"),c=a.find("a"),b=c.data("type"),c=c.data("col");
void 0!==c&&(c>w||4===w&&3===c||4<=w&&4<=c&&w!=c)&&(a.removeClass("selected"),m.removeClass("tb_grid_classes col-count-"+m.attr("data-basecol")+" "+m.attr("data-col_"+b)).attr("data-col_"+b,""),f(this).closest(".themify_builder_grid_list").find("."+b+"-auto").parent().addClass("selected"))})}else return"-auto"!==c[0]?(h="column"+c.join("-"),w=a.data("col"),3===w&&m.attr("data-basecol")>w&&(h+=" tb_3col"),"mobile"===b.activeBreakPoint&&m.removeClass(m.attr("data-col_tablet")),m.removeClass(m.attr("data-col_"+
e)).addClass(h+" tb_grid_classes col-count-"+m.attr("data-basecol")).attr("data-col_"+e,h)):m.removeClass("tb_grid_classes tb_3col col-count-"+m.attr("data-basecol")+" "+m.attr("data-col_"+e)).attr("data-col_"+e,""),"visual"===b.mode&&f("body",top_iframe).height(document.body.scrollHeight),b.Utils.setCompactMode(m.children(".module_column")),!1;e=m.children(".module_column");k=c.length;d="module_column"+(g?" sub_column":"")+" col";for(l=0;l<k;++l)n=e.eq(l),0<n.length?n.removeClass(b.Utils.gridClass.join(" ")).addClass(d+
c[l]):b.Utils._addNewColumn({newclass:d+c[l],component:g?"sub-column":"column",type:b.mode},m);k<m.children().length&&m.children(".module_column").eq(k-1).nextAll().each(function(){f(this).find(".themify_module_holder").first().children().appendTo(f(this).prev().find(".themify_module_holder").first());f(this).remove()});e=m.children();e.removeClass("first last");m.hasClass("direction-rtl")?(e.last().addClass("first"),e.first().addClass("last")):(e.first().addClass("first"),e.last().addClass("last"));
g&&"-full"===c[0]&&(c=m.closest(".module_subrow"),g=c.closest(".module_column"),e=m.find(".active_module"),e.insertAfter(c),c.remove(),b.Mixins.Builder.initGridMenu(g[0],!0),e.find(".themify_builder_grid_list .grid-layout--full").parent().addClass("selected").siblings().removeClass("selected"));b.Utils.columnDrag(m,!0);l=a.closest(".module_row");b.Mixins.Builder.columnSort(l);b.Mixins.Builder.updateModuleSort(l);b.vent.trigger("dom:change",l.data("cid"),h,l,"row")}},_columnAlignmentMenuClicked:function(a){a.preventDefault();
a=f(a.currentTarget);var c=a.data("handle");if("module"!==c&&!a.closest("li").hasClass("selected")){a.closest("li").addClass("selected").siblings("li").removeClass("selected");var d=a.closest(".module_"+c);var g=a.data("alignment"),e=b.Models.Registry.lookup(d.data("cid")),k=ThemifyBuilderCommon.Lightbox.clone(d);d.find("."+c+"_inner").first().removeClass(e.get("column_alignment")).addClass(g);e.set({column_alignment:g},{silent:!0});b.vent.trigger("dom:change",k.data("cid"),k,a.closest(".module_"+
c),"row")}},_columnDirectionMenuClicked:function(a){a.preventDefault();var c=f(a.currentTarget),d=c.data("handle");a=c.data("dir");if("module"!==d&&!c.closest("li").hasClass("selected")){c.closest("li").addClass("selected").siblings("li").removeClass("selected");var g=c.closest(".module_"+d);var c="tablet_landscape"===b.activeBreakPoint?"tablet":b.activeBreakPoint,d=g.find("."+d+"_inner").first(),e=d.children(".module_column");g=e.first();e=e.last();"rtl"===a?(g.removeClass("first").addClass("last"),
e.removeClass("last").addClass("first"),d.addClass("direction-rtl")):(g.removeClass("last").addClass("first"),e.removeClass("first").addClass("last"),d.removeClass("direction-rtl"));d.attr("data-"+c+"_dir",a)}},_gutterChange:function(a){a=f(a.currentTarget);var c=a.data("handle");if("module"!==c){var d=a.val();a.find("option").removeAttr("selected").filter('[value="'+d+'"]').attr("selected","selected");var g=a.closest(".module_"+c),e=ThemifyBuilderCommon.Lightbox.clone(g),k=g.find("."+c+"_inner").first(),
h=b.Models.Registry.lookup(g.data("cid"));e.find(".themify_builder_"+c+"_top .gutter_select").val(g.data("gutter"));b.Utils.columnDrag(k,!1,h.get("gutter"),d);k.removeClass(h.get("gutter")).addClass(d);h.set({gutter:d},{silent:!0});b.vent.trigger("dom:change",e.data("cid"),e,a.closest(".module_"+c),"row")}},setView:function(a){this.setElement(a)},toggleRow:function(a){a.preventDefault();a.stopPropagation();var c=f(a.currentTarget).closest(".module_row");c.find(".row_inner").first().slideToggle("fast",
function(){c.toggleClass("collapsed")})}});b.Views.Builder=Backbone.View.extend({type:"default",events:{"click .tb-import-layout-button":"importLayoutButton"},initialize:function(a){_.extend(this,_.pick(a,"type"));b.vent.on("dom:builder:change",this.tempEvents.bind(this));b.vent.on("dom:builder:init",this.init.bind(this))},init:function(a){b.init=a;this.rowSort();this.initGridMenu(this.el,!0);"visual"===b.mode?(this.updateModuleSort(this.$el),a&&this.initModuleVisualDrag(),setTimeout(function(){b.Utils._onResize(!0)},
1500)):(a&&this.initModuleDraggable(b.toolbar.$el),this.updateModuleSort(f("body")));var c=this;setTimeout(function(){b.Utils.setCompactMode(c.el.getElementsByClassName("module_column"))},1E3);b.vent.trigger("dom:builder:change");this.insertLayoutButton();themifyBuilder.is_premium||ThemifyBuilderCommon.setUpTooltip();b.init=!0},render:function(){for(var a=document.createDocumentFragment(),c=this.collection,d=!1,g=0,e=c.length;g<e;++g){var f=b.Views.init_row(c.models[g],this.type);if(!1!==f){b.id&&
(d=f.model.get("row_order"),void 0===d&&(d=g));var h=f.view.render(d).el;b.id&&(b.VisualCache[f.model.cid]="themify_builder_"+b.id+"_row module_row_"+d,h.className+=" "+b.VisualCache[f.model.cid]);a.appendChild(h)}}this.el.appendChild(a);b.Utils.columnDrag(!1,!1);return this},tempEvents:function(){this.newRowAvailable()},insertLayoutButton:function(){this.$el.find(".tb-import-layout-button").remove();2>this.$(".module_row").length&&this.el.insertAdjacentHTML("beforeend",'<a href="#" class="tb-import-layout-button'+
(themifyBuilder.is_premium?"":" themify_builder_lite")+'">'+themifyBuilder.i18n.text_import_layout_button+"</a>")},importLayoutButton:function(a){a.preventDefault();b.Views.Toolbar.prototype.loadLayout(a)}});b.Mixins.Common={styleData:{},doTheBinding:function(a,c,b){var d=!1,e=a.data("binding");c||void 0===e.empty?c&&void 0!==e[c]?d="radio"===a.attr("type")?a.is(":checked")?e[c]:!1:e[c]:c&&void 0!==e.not_empty?d=e.not_empty:void 0!==e.select&&c!==e.select.value?d=e.select:void 0!==e.checked&&a.is(":checked")?
d=e.checked:void 0===e.not_checked||a.is(":checked")||(d=e.not_checked):d=e.empty;if(d){c=[];void 0!==d.show&&(c=d.show);void 0!==d.hide&&(c=c.concat(d.hide));if(void 0===b||0===b.length)b=f("#themify_builder_lightbox_container",top_iframe);a=0;for(c=c.length;a<c;++a)void 0!==d.hide&&void 0!==d.hide[a]&&f("."+d.hide[a],b).addClass("_tf-hide").hide(),void 0!==d.show&&void 0!==d.show[a]&&f("."+d.show[a],b).removeClass("_tf-hide").show()}},moduleOptionsBinding:function(){var a=this;f("#themify_builder_lightbox_container",
top_iframe).on("change","[data-binding]",function(){a.doTheBinding(f(this),f.trim(f(this).val()),f(this).closest(".tb_repeatable_field_content"))}).on("click",".themify-layout-icon[data-binding] a",function(){a.doTheBinding(f(this).parent(),f(this).prop("id"),f(this).closest(".tb_repeatable_field_content"))})},mode_change:function(a){function c(a){null===k&&(k=ThemifyBuilderCommon.Lightbox.$lightbox.find("#themify_builder_options_styling")[0]);e.styleData["breakpoint_"+a]=b.Forms.serialize("themify_builder_options_styling",
e.styleData,a,!1)}function d(b,d,g){c(d);e.editComponentCallback(k,a,e.styleData,!0)}var g="module"===a&&void 0!==b.activeModel.get("is_new")?f(".tb_element_cid_"+b.activeModel.cid).closest(".module_row"):f(".tb_element_cid_"+b.activeModel.cid);b.beforeEvent=ThemifyBuilderCommon.Lightbox.clone(g);var e=this,k=null;e.styleData={};e.styleData.breakpoint_desktop=f.extend(!0,{},b.activeModel.get("module"===a?"mod_settings":"styling"));for(var h in themifyBuilder.breakpoints)void 0!==e.styleData.breakpoint_desktop["breakpoint_"+
h]&&(e.styleData["breakpoint_"+h]=e.styleData.breakpoint_desktop["breakpoint_"+h],delete e.styleData.breakpoint_desktop["breakpoint_"+h]);f("body").off("themify_builder_change_mode",d).on("themify_builder_change_mode",d).one("themify_builder_lightbox_before_close",function(){q=[];b.saving&&c(b.activeBreakPoint);f("body").off("themify_builder_change_mode",d)})},editComponentCallback:function(a,c,d,g){var e="styling",k=b.Mixins.Common,h=c,l=[],n=[],t=[],m=[],w=[],u=[],p=!1,B="desktop"!==b.activeBreakPoint?
Object.keys(themifyBuilder.breakpoints).reverse():!1;"module"===c&&(h=b.activeModel.get("mod_name"),e="mod_settings",p=void 0!==b.activeModel.get("is_new"));if(!1!==B){for(var x=B.indexOf(b.activeBreakPoint),r=0;r<=x;++r)B.shift();B.push("desktop")}var F=function(a,c,d,e){var r="";e?r=a.getAttribute("data-input-id"):(r=a.getAttribute("name"))||(r=a.getAttribute("id"));var v=void 0!==c[r]?c[r]:!1;if(g||"px"!==v&&"pixels"!==v&&"solid"!==v&&"|"!==v&&"default"!==v){var y=f(a);c=a.classList;if(!p&&!1!==
B&&!e&&!v)if(c.contains("themify-checkbox"))void 0!==d[r]&&0===y.closest("#themify_builder_options_styling").length&&(v=d[r]);else{e=0;for(var x=B.length;e<x;++e)if(void 0!==d["breakpoint_"+B[e]]&&void 0!==d["breakpoint_"+B[e]][r]){v=d["breakpoint_"+B[e]][r];break}else if("desktop"===B[e]&&void 0!==d[r]){v=d[r];break}}if(c.contains("themify-gradient"))m.push({k:y,v:v}),v&&y.val(v);else if(c.contains("themify-builder-uploader-input"))v?(d=f("<img/>",{src:v,width:50,height:50}),y.val(v).parent().find(".img-placeholder").html(d)):
g&&y.val("").parent().find(".img-placeholder").empty();else if(c.contains("themify-option-query-cat"))v&&(d=y.parent(),e=v.split("|")[0],d.find("#"+r+"_dropdown").children("option[value='"+e+"']").prop("selected",!0),d.find(".query_category_multiple").val(e));else if(c.contains("tb-radio-input-container"))d=null,e=v?v:void 0!==y.data("default")?y.data("default"):!1,!1!==e&&""!==e?(d=y.find("input[value='"+e+"']"),d.is(":disabled")?d=null:d.prop("checked",!0)):g&&c.contains("tb-icon-radio")&&y.find("input").prop("checked",
!1),null===d&&(d=y.find("input:checked")),0<d.length&&c.contains("tb-option-radio-enable")&&n.push(d);else if(c.contains("themify-checkbox")){d=y.find(".tb-checkbox");if(v){var D=v.split("|");d.each(function(){-1!==D.indexOf(f(this).val())&&f(this).prop("checked",!0)})}else if(!p||g)if(e=d.closest(".themify_builder_input").find(".tb_seperate_items input"),e.length){var C=!1;e.each(function(){if(f(this).val().length)return C=!0,!1});d.prop("checked",!C)}else d.prop("checked",!1);c.contains("tb-option-checkbox-enable")&&
t.push(d)}else if(c.contains("themify-layout-icon"))v?y.find("a").filter(function(){f(this).removeClass("selected");if(v===f(this).prop("id"))return f(this)}).addClass("selected"):(d=themifyBuilder.modules[h],void 0!==d&&void 0!==d.defaults&&d.defaults[r]?y.find("#"+d.defaults[r]).addClass("selected"):y.find("a").first().addClass("selected"));else if("SELECT"===a.tagName)v?(y.val(v),c.contains("font-family-select")&&y.data("selected",v)):g&&y.find("option").prop("selected",!1),g&&c.contains("font-family-select")&&
(-1===y.prop("tabindex")?y.trigger("change.select"):v&&(d=y.find("optgroup"),void 0!==ThemifyBuilderCommon.safe_fonts[v]?d.first().html('<option selected="selected" data-type="webfont" value="'+v+'">'+ThemifyBuilderCommon.safe_fonts[v]+"</option>"):d.last().html('<option selected="selected" value="'+v+'">'+ThemifyBuilderCommon.google_fonts[v]+"</option>")));else if("TEXTAREA"===a.tagName||"INPUT"===a.tagName){d="TEXTAREA"===a.tagName;if(v||g)if(g&&!v&&(v=""),y.val(v),c.contains("minicolors-input")){var q=
v;e="";-1!==v.indexOf("_")?(q=b.Utils.toRGBA(v),v=v.split("_"),(e=v[1])||(e=1),y.val(v[0]),"visual"===b.mode&&setTimeout(function(){f("body").trigger("themify_builder_color_picker_change",[r,y,q])},10)):v&&(-1===v.indexOf("#")&&(q="#"+v),e=1);y.attr("data-opacity",e).next(".minicolors-swatch").find("span").css({background:q,opacity:e}).closest(".minicolors").next(".color_opacity").val(e)}else d&&!p&&(c.contains("tb-shortcode-input")||c.contains("tb-thumbs-preview"))&&k.getShortcodePreview(y,v);d&&
c.contains("tb_lb_wp_editor")&&l.push(y)}else if(c.contains("themify_builder_row_js_wrapper")){var A=v?v.length-1:0,z=f.Event("click",{isTrigger:!0,currentTarget:y.next(".add_new").find("a").first()});void 0===b.cache.repeaterElements[r]&&(x=a.getElementsByClassName("tb_repeatable_field"),b.cache.repeaterElements[r]=f(x[0]).clone());for(e=0;e<A;++e)b.Forms.moduleOptAddRow(z,null);x=a.getElementsByClassName("tb_repeatable_field");e=0;for(a=x.length;e<a;++e)for(var A=x[e].getElementsByClassName("tb_lb_option_child"),
z=void 0!==v[e]?v[e]:!1,E=0,G=A.length;E<G;++E)F(A[E],z,d,!0);w.push({el:y,binding_type:y.data("control-binding")})}y.data("binding")&&u.push({el:y,v:v});!g&&!c.contains("tb_lb_wp_editor")&&y.data("control-binding")&&y.data("control-type")&&"repeater"!==y.data("control-type")&&b.Views.init_control(y.data("control-type"),{el:y,binding_type:y.data("control-binding")})}};d=g?d:b.activeModel.get(e);var A=f.extend(!0,{},d);if("desktop"!==b.activeBreakPoint||g)if(void 0!==A["breakpoint_"+b.activeBreakPoint])A=
A["breakpoint_"+b.activeBreakPoint];else for(r=0,e=B.length;r<e;++r)if(void 0!==A["breakpoint_"+B[r]]){A=A["breakpoint_"+B[r]];break}e=a.getElementsByClassName("tb_lb_option");r=0;for(x=e.length;r<x;++r)F(e[r],A,d,!1);e=null;g||(0<w.length&&setTimeout(function(){for(var a=0,c=w.length;a<c;++a)b.Views.init_control("repeater",w[a]);w=null},1),setTimeout(function(){if("module"===c)for(var a=0,b=u.length;a<b;++a)k.doTheBinding(u[a].el,u[a].v);u=null;k.moduleOptionsBinding()},1));setTimeout(function(){for(var a=
0,c=n.length;a<c;++a)ThemifyBuilderCommon.Lightbox.clickRadioOption(null,n[a]);n=null},1);setTimeout(function(){for(var a=0,c=t.length;a<c;++a)ThemifyBuilderCommon.Lightbox.clickCheckboxOption(null,t[a]);t=null},1);setTimeout(function(){k.applyAll_init(g);for(var c=a.getElementsByClassName("border_style"),b=0,d=c.length;b<d;++b)ThemifyBuilderCommon.Lightbox.hideShowBorder(null,f(c[b]))},1);void 0!==f.fn.ThemifyGradient&&setTimeout(function(){for(var a=0,c=m.length;a<c;++a)b.Utils.createGradientPicker(m[a].k,
m[a].v,g);m=null},1);g||(setTimeout(function(){ThemifyBuilderCommon.fontPreview(f("#themify_builder_lightbox_container",top_iframe))},1),p&&"gallery"===h&&setTimeout(function(){f(".tb-gallery-btn",a).trigger("click")},1),setTimeout(function(){b.Utils.builderPlupload("normal")},1),setTimeout(function(){b.Utils.setColorPicker(a)},1),"visual"===b.mode&&(setTimeout(function(){q="module"===c?b.Forms.serialize("themify_builder_options_setting"):A;b.liveStylingInstance.init(q)},1),p||ThemifyBuilderCommon.Lightbox.rememberRow()),
setTimeout(function(){if(0<l.length){var a=function(){for(var a=0,c=l.length;a<c;++a)b.Views.init_control("wp_editor",{el:l[a],binding_type:l[a].data("control-binding")});l=null};if(b.activeModel.get("styleClicked")||b.activeModel.get("visibileClicked"))f("body").one("themify_builder_tabsactive",function(c,b,d){"#themify_builder_options_setting"===b&&a()});else a()}k.mode_change(c)},1),f("body").trigger("editing_"+c+"_option",[h,A,a]),"visual"===b.mode&&window.top.jQuery("body").trigger("editing_"+
c+"_option",[h,A,a]))},applyAll_init:function(a){var c=f(".style_apply_all",top_iframe);c.off("change.tb_apply_all").on("change.tb_apply_all",function(a){var c=f(this).closest(".themify_builder_input").find(".tb_seperate_items"),b=c.find("li");a=!a.isTrigger;f(this).is(":checked")?(a?b.not(":first-child").slideUp():b.not(":first-child").hide(),c.attr("data-checked",1)):(b.slideDown(),c.removeAttr("data-checked"));a&&b.first().find("select").trigger("change")});a||(c=c.filter(":checked"));c.trigger("change.tb_apply_all")},
getShortcodePreview:function(a,c){function b(c){a.next(".tb_shortcode_preview").remove();c&&a.after(c)}var g=this;void 0===g.galerry_cache&&(g.galerry_cache={});void 0!==g.galerry_cache[c]?b(g.galerry_cache[c]):f.ajax({type:"POST",url:themifyBuilder.ajaxurl,data:{action:"tb_load_shortcode_preview",tb_load_nonce:themifyBuilder.tb_load_nonce,shortcode:c},success:function(a){b(a);g.galerry_cache[c]=a}})}};b.Mixins.Builder={rowSort:function(){var a=!1,c=this,d,g,e,k={items:".module_row",handle:".themify_builder_row_top",
axis:"y",placeholder:"themify_builder_ui_state_highlight",containment:"parent",tolerance:"pointer",forceHelperSize:!0,forcePlaceholderSize:!0,scroll:!1,beforeStart:function(d,e){c.dragScroll();"visual"!==b.mode||e.item.hasClass("collapsed")||(a=!0,e.item.addClass("collapsed ui-sortable-row"))},start:function(a,c){d=c.placeholder.index();e=c.item.outerHeight(!0);c.item.nextAll(".module_row").css("transform","translateY("+e+"px)")},change:function(a,c){g=c.placeholder.index();var b=!1;d>g?(b=f(".module_row"),
b=b.slice(g,b.length)):d<g&&(b=f(".module_row").slice(d,g),e=0);!1!==b&&b.not(".ui-sortable-helper").each(function(){f(this).css("transform","translateY("+e+"px)")});d=g},stop:function(b,d){a&&(d.item.removeClass("collapsed ui-sortable-row"),a=!1);f(".ui-sortable-handle, .module_row").css("transform","");c.dragScroll(!0)},update:function(a,b){b.item.hasClass("predesigned_row")&&f(document).trigger("tb_setpredesignedrows",[b.item.data("slug"),function(a){c.rowDrop(a,b.item)}])}};"visual"===b.mode&&
(k.helper=function(){return f('<div class="themify_builder_sortable_helper"/>')});this.$el.sortable(k);this.columnSort(this.$el)},columnSort:function(a){var c,d=f("body"),g;a.find(".row_inner, .subrow_inner").sortable({items:"> .module_column",handle:"> .themify_builder_column_action .themify_builder_column_dragger",axis:"x",placeholder:"themify_builder_ui_state_highlight",tolerance:"pointer",cursorAt:{top:20,left:20},beforeStart:function(a,b){d.addClass("themify_builder_drag_start");c=ThemifyBuilderCommon.Lightbox.clone(b.item.closest(".module_row"));
g=b.item.siblings();g.css("marginLeft",0)},start:function(a,c){f(".themify_builder_ui_state_highlight").width(c.item.width())},stop:function(a,c){d.removeClass("themify_builder_drag_start");g.css("marginLeft","")},update:function(a,d){var e=d.item.closest(".ui-sortable"),g=e.children(".module_column");g.removeClass("first last");e.hasClass("direction-rtl")?(g.last().addClass("first"),g.first().addClass("last")):(g.first().addClass("first"),g.last().addClass("last"));b.Utils.columnDrag(e,!1);b.Utils.setCompactMode(g);
e=e.closest(".module_row");b.vent.trigger("dom:change",e.data("cid"),c,e,"row")}})},update:function(a){var c=null!==b.activeModel?b.activeModel.get("elType"):b.Models.Registry.lookup(a.data("cid")).get("elType");"visual"===b.mode&&b.Utils.loadContentJs(a,c);b.Mixins.Builder.initGridMenu(a[0],"module"!==c);b.Mixins.Builder.columnSort(a);a=a.closest(".module_row");b.Utils.columnDrag(a.find(".row_inner"),!1);b.Utils.columnDrag(a.find(".subrow_inner"),!1);this.updateModuleSort(a)},dragScroll:function(a){var c=
f("body",top_iframe);"visual"===b.mode&&(c=c.add(f("body")));void 0===this.top&&(this.top=b.toolbar.$el,this.top=this.top.add(f("#themify_builder_fixed_bottom_scroll",top_iframe)),"visual"!==b.mode&&(this.top=this.top.add("#wpadminbar")));if(!0===a)this.top.off("mouseenter"),c.removeClass("themify_builder_drag_start");else{var d="desktop"===b.activeBreakPoint?f("body,html"):f("body,html",top_iframe),g="",e=0;"visual"===b.mode?(g=d.height(),e=f(window.parent).height()):g=f("#page-builder").height();
c.addClass("themify_builder_drag_start");this.top.off("mouseenter").on("mouseenter",function(a){a=parseInt((g-e)/7);if(0<a){var c=f(this).prop("id");a=("tb_toolbar"===c||"wpadminbar"===c?"-":"+")+("="+a+"px");d.stop().animate({scrollTop:a},800)}else d.stop()})}},updateModuleSort:function(a,c){var d=c?f(".themify_module_holder"):a.find(".themify_module_holder");if(c)return d.sortable(c),!1;d.each(function(){f(this).data().uiSortable=null});var g=!1,e=!1,k=this,h={placeholder:"themify_builder_ui_state_highlight",
items:".active_module",connectWith:".themify_module_holder",revert:100,scroll:!1,tolerance:"pointer",cursorAt:{top:20,left:110},beforeStart:function(a,c){!1===e&&(e=ThemifyBuilderCommon.Lightbox.clone(c.item.closest(".module_row")),"visual"===b.mode&&(c.item.css("height",40),g=!0),k.dragScroll())},stop:function(a,c){k.dragScroll(!0);if("dragstop"!==a.type){g&&(c.item.css("height",""),g=!1);var d=c.item.closest(".module_row");b.vent.trigger("dom:change",c.item.data("cid"),e,d,"sort",{before:e.data("cid"),
after:d.data("cid")})}e=!1},update:function(a,c){c.sender?(c.item.hasClass("module_subrow")&&0<c.item.parents(".module_subrow").length?(c.item.find(".active_module").clone().insertAfter(c.item),c.item.remove()):b.Mixins.Builder.initGridMenu(c.item[0]),b.vent.trigger("dom:builder:change")):c.item.hasClass("tb_module_dragging_helper")&&k.moduleDrop(c.item,!1)}};"visual"===b.mode&&(h.helper=function(){return f('<div class="themify_builder_sortable_helper"/>')},h.handle=".themify_builder_module_front_overlay, .themify_builder_subrow_top");
d.sortable(h)},initModuleDraggable:function(a){var c=this;a.find(".themify_builder_module").draggable({appendTo:"body",helper:"clone",revert:"invalid",scroll:!1,connectToSortable:".themify_module_holder",containment:"#themify_builder_row_wrapper,.themify_builder_content",cursorAt:{top:10,left:40},start:function(a,g){c.dragScroll();g.helper.addClass("tb_module_dragging_helper").removeClass("themify_builder_module");b.toolbar.preDesignedRows.btn.hide()},stop:function(a,b){c.dragScroll(!0)}})},initModuleVisualDrag:function(){var a=
this;b.toolbar.$el.find(".themify_builder_module").ThemifyDraggable({iframe:"#themify_builder_site_canvas_iframe",dropitems:".themify_module_holder",elements:".active_module",onDragStart:function(a,d){b.toolbar.preDesignedRows.btn.hide()},onDragEnd:function(a,b){},onDrop:function(c,b,g){a.moduleDrop(b,!1)}})},initRowDraggable:function(a){var c=this;a.find(".predesigned_row").draggable({appendTo:"body",helper:"clone",revert:"invalid",connectToSortable:"#themify_builder_row_wrapper,.themify_builder_content",
cursorAt:{top:10,left:40},start:function(a,g){c.dragScroll();g.helper.addClass("tb_module_dragging_helper").find(".tb_predesigned_rows_list_image").remove();b.toolbar.preDesignedRows.btn.hide()},stop:function(a,b){c.dragScroll(!0)}})},initRowVisualDrag:function(){var a=this;b.toolbar.$el.find(".predesigned_row").ThemifyDraggable({iframe:"#themify_builder_site_canvas_iframe",dropitems:".module_row",append:!1,onDragStart:function(a,d){b.toolbar.preDesignedRows.btn.hide()},onDragEnd:function(a,b){},
onDrop:function(c,b,g){f(document).trigger("tb_setpredesignedrows",[b.data("slug"),function(c){a.rowDrop(c,b)}])}})},rowDrop:function(a,c){function d(){var a=c.prev(".module_row"),d=c.closest(".themify_builder_content").data("postid"),a=0===a.length?!1:a.data("cid");c[0].innerHTML="";c[0].parentNode.replaceChild(g,c[0]);b.saveCid=!1;b.rowStyling=[];b.vent.trigger("dom:change","","","","predesign",{prev:a,rows:e,bid:d});a=0;for(d=e.length;a<d;++a)b.Mixins.Builder.update(e[a]);ThemifyBuilderCommon.showLoader("hide")}
var g=document.createDocumentFragment(),e=[];b.saveCid=!0;for(var f in a)if(a[f].cols&&(1<Object.keys(a[f].cols)||0<Object.keys(a[f].cols[0].styling))||a[f].styling&&0<Object.keys(a[f].styling).length){var h=b.Views.init_row(a[f],b.mode);!1!==h&&(h=h.view.render(),g.appendChild(h.el),e.push(h.$el))}"visual"===b.mode?b.bootstrap(b.rowStyling,d):d()},moduleDrop:function(a,c){var d=b.Views.init_module({mod_name:a.data("module-slug")},b.mode),g=d.view.render();d.model.set({is_new:1},{silent:!0});c?c.append(g.el):
a.replaceWith(g.el);d.view.trigger("edit",null);"visual"===b.mode&&(g=d.model.getPreviewSettings(),1<Object.keys(g).length&&("ajax"===a.data("type")?d.model.trigger("custom:preview:refresh",g):d.model.trigger("custom:preview:live",g)))},newRowAvailable:function(){var a=this.$el.children(".module_row");if(0===a.length||0<a.last().find(".active_module").length)a=b.Views.init_row({cols:[{grid_class:"col-full"}]},this.type).view.render().$el,a.appendTo(this.$el),this.$el.sortable(this.$el.sortable("option")),
b.Mixins.Builder.updateModuleSort(a),"visual"===b.mode&&"desktop"!==b.activeBreakPoint&&f("body",top_iframe).height(document.body.scrollHeight)},initGridMenu:function(a,c){var b=!0===c?a.getElementsByClassName("active_module"):[a];void 0===this.grid_menu&&(this.grid_menu=ThemifyBuilderCommon.templateCache.get("tmpl-builder_grid_menu"),this.grid_menu=f(this.grid_menu),this.grid_menu.find(".grid-layout--full").closest("li").addClass("selected"),this.grid_menu=this.grid_menu[0].outerHTML);for(var g=
0,e=b.length;g<e;++g)-1===b[g].className.indexOf("module_subrow")&&0===b[g].getElementsByClassName("grid_menu").length&&0===f(b[g]).closest(".sub_column").length&&b[g].insertAdjacentHTML("afterbegin",this.grid_menu)},toJSON:function(){for(var a={},c=this.el.getElementsByClassName("module_row"),d=0,g=c.length;d<g;++d)a[d]=b.Utils._getRowSettings(c[d],d);return a}};b.Forms={Data:{},Validators:{},bindEvents:function(){f("body",top_iframe).on("true"===themifyBuilder.isTouch?"touchend":"click",".builder_save_button",
this.saveComponent).on("click","#themify_builder_lightbox_parent .add_new a",this.moduleOptAddRow).on("click","#builder_submit_import_form",this.builderImportSubmit).on("click",".tb-lightbox-switcher a",this.lightbox_switcher).on("click",".layout_preview img",this.templateSelected).on("click","#builder_submit_layout_form",this.saveAsLayout);f("body").on("themify_builder_lightbox_close",this.clear);this.widget_actions()},parseSettings:function(a,c,d,g){var e=!1,k=f(a),h=a.classList,l="",n=!0;g?l=k.data("input-id"):
(l=a.getAttribute("name"))||(l=a.getAttribute("id"));if(h.contains("tb_lb_wp_editor"))void 0!==tinyMCE?(e=a.getAttribute("id"),a=tinyMCE.get(e),e=null!==a?!1===a.hidden?a.getContent():switchEditors.wpautop(tinymce.DOM.get(e).value):k.val()):e=k.val();else if(h.contains("themify-checkbox")){var t=[];k.find(".tb-checkbox:checked").each(function(a){t.push(f(this).val())});e=0<t.length?t.join("|"):!1;t=null;n=!1}else if(h.contains("themify-layout-icon"))e=k.find(".selected").prop("id"),a=themifyBuilder.modules[b.activeModel.get("mod_name")],
void 0!==a&&void 0!==a.defaults&&e===a.defaults[l]&&(e=!1);else if(h.contains("themify-option-query-cat"))a=k.parent(),e=a.find(".query_category_single"),a=a.find(".query_category_multiple"),e=a.val()?a.val()+"|multiple":e.val()+"|single";else if(h.contains("themify_builder_row_js_wrapper"))for(e=[],a=a.getElementsByClassName("tb_repeatable_field_content"),g=0,h=a.length;g<h;++g){var m=a[g].getElementsByClassName("tb_lb_option_child");e[g]={};for(var w=0,u=m.length;w<u;++w){var p=this.parseSettings(m[w],
c,d,!0);p&&"px"!==p.v&&"pixels"!==p.v&&"solid"!==p.v&&"default"!==p.v&&"|"!==p.v&&(e[g][p.id]=p.v)}}else h.contains("tb-radio-input-container")?(n=k.find("input:checked"),"desktop"!==d&&n.hasClass("reponive_disable")||(e=n.val()),n=!1):h.contains("module-widget-form-container")?e=k.find(":input").themifySerializeObject():(e=k.val(),a=k.attr("data-opacity"),void 0!==a&&""!==a&&1!=a&&"0.99"!==a&&(e+="_"+a));if(e||!c)if(!c||c&&"px"!==e&&"pixels"!==e&&"solid"!==e&&"linear"!==e&&"default"!==e&&"|"!==e&&
("desktop"===d||0===k.closest(".reponive_disable").length))return c||!1!==e||(e=""),{id:l,v:e,checked:n};return!1},serialize:function(a,c,d){d=d||b.activeBreakPoint;var g=void 0!==c;void 0===this.breakpoints&&"desktop"!==d&&g&&(this.breakpoints=Object.keys(themifyBuilder.breakpoints).reverse());var e={};a=top_iframe.getElementById(a).getElementsByClassName("tb_lb_option");var f="desktop"!==d&&g&&void 0!==this.breakpoints?this.breakpoints:!1;if(!1!==f){for(var h=f.indexOf(d),l=0;l<=h;++l)f.shift();
f.push("desktop")}l=0;for(h=a.length;l<h;++l){var n=this.parseSettings(a[l],g,d,!1);if(!1!==n){if(!1!==f&&!0===n.checked&&"SELECT"!==a[l].tagName){for(var t=!1,m=0,w=f.length;m<w;++m)if(void 0!==c["breakpoint_"+f[m]]&&void 0!==c["breakpoint_"+f[m]][n.id]&&c["breakpoint_"+f[m]][n.id]===n.v){t=!0;break}else if("desktop"===f[m]&&void 0!==c[n.id]&&c[n.id]===n.v){t=!0;break}if(t)continue}e[n.id]=n.v}}return e},saveComponent:function(a){a.preventDefault();var c=b.Forms,d=b.activeModel.get("elType");a="module"===
d;if(!a||c.isValidate(f("#tb_module_settings",top_iframe))){b.saving=!0;var g={},e=null,k=!1,h=!1,l=null,n=null,t=!1,m="styling",w=f(".tb_element_cid_"+b.activeModel.cid);if(a||"row"===d)a&&(m="mod_settings",k=b.activeModel.get("is_new"),b.activeModel.unset("is_new",{silent:!0})),n=c.serialize("themify_builder_options_setting"),e=c.serialize("themify_builder_options_animation"),l=c.serialize("themify_builder_options_visibility"),"visual"===b.mode&&("hide_all"===l.visibility_all||"hide"===l.visibility_desktop||
"hide"===l.visibility_tablet||"hide"===l.visibility_mobile?w.addClass("tb_visibility_hidden"):w.removeClass("tb_visibility_hidden"));"visual"===b.mode&&b.liveStylingInstance.remember(b.activeModel.cid);ThemifyBuilderCommon.Lightbox.close();var c=f.extend(!0,{},b.Mixins.Common.styleData),d=f.extend(!0,{},b.activeModel.get(m)),u=c.breakpoint_desktop;delete c.breakpoint_desktop;for(var p in c)u[p]=c[p];g[m]=f.extend(!0,u,n,e,l);g[m]=b.Utils.clear(g[m]);b.activeModel.set(g,{silent:!0});a&&(k&&(h=ThemifyBuilderCommon.Lightbox.clone(w.closest(".module_column")),
b.Mixins.Builder.initGridMenu(w[0])),b.vent.trigger("dom:builder:change"),f(".tb-import-layout-button").remove());if("visual"===b.mode){var B=b.liveStylingInstance.getRememberedStyles();void 0===b.isComponentSaved[b.activeModel.cid]&&(b.isComponentSaved[b.activeModel.cid]=1,t=!0)}b.vent.trigger("dom:change",b.activeModel.cid,b.beforeEvent,w,"save",{old:d,"new":g[m],styles:B,column:h,first:t});b.beforeEvent=!1;b.saving=!1}},moduleOptAddRow:function(a,c){a.preventDefault();var d=f(a.currentTarget).parent().prev(),
g=b.cache.repeaterElements[d.prop("id")].clone(),e=Math.random().toString(36).substr(2,7),k=[],h=!1,l=!1,n=!a.isTrigger||c;g.removeClass("collapsed").find(".row_inner").show();var t=g[0].getElementsByClassName("tb_lb_option_child");c=c?f(c):!1;for(var m=0,w=t.length;m<w;++m){var u=f(t[m]);var p=c?c.find('[data-input-id="'+u.data("input-id")+'"]'):!1;var B=t[m].classList;if(B.contains("tb_lb_wp_editor")){var x=u.data("input-id");var r=u.data("control-repeater");var q=u.closest(".wp-editor-wrap");u=
x+"_"+m+"_"+Math.random().toString(36).substr(2,7);!1===h&&(h=q.html());q.html(h.replace(new RegExp(x,"g"),u));u=q.find(".tb_lb_wp_editor");u.attr({name:x,"data-input-id":x,"data-control-repeater":r}).data({"input-id":x,"control-repeater":r});p?(p=p.prop("id"),q=tinyMCE.get(p),p=!1===q.hidden?q.getContent():switchEditors.wpautop(tinymce.DOM.get(p).value),u.val(p)):u.val("");k.push(u)}else if(B.contains("themify-layout-icon"))q=u.find("a"),q.removeClass("selected"),p?q.filter("#"+p.find(".selected").prop("id")).addClass("selected"):
(p=themifyBuilder.modules[b.activeModel.get("mod_name")],void 0!==p&&void 0!==p.defaults&&p.defaults[x]?q.filter("#"+p.defaults[x]).addClass("selected"):q.first().addClass("selected"));else if(B.contains("themify-builder-uploader-input"))n&&(l=!0,p=!1!==p?p.val():"",q=u.val(p).parent(),r=q.find(".thumb_preview").find(".img-placeholder"),q.find(".tb-upload-btn").prop("id","pluploader_"+e+"_"+m+"themify-builder-plupload-upload-ui").addClass("plupload-clone").find(".builder_button").prop("id","pluploader_"+
e+"_"+m+"themify-builder-plupload-browse-button"),""!==p&&(p=f("<img/>",{src:p,width:50,height:50}),r.html(p)));else if(B.contains("tb-radio-input-container")){q=t[m].getElementsByClassName("themify-builder-radio-dnd");r=u.data("input-id");var A=p?p.find(":checked").val():!1;p=0;for(var z=q.length;p<z;++p){var C=f(q[p]);C.prop({name:r+"_"+e,id:r+"_"+e+"_"+p,checked:!1}).next("label").prop("for",r+"_"+e+"_"+p);(A===C.val()||!A&&C.data("checked"))&&C.prop("checked",!0)}B.contains("tb-option-radio-enable")&&
ThemifyBuilderCommon.Lightbox.clickRadioOption(null,u.find(":checked"))}else A=p?p.val():"",void 0===A&&(A=""),u.val(A);n&&(u.data("binding")&&b.Mixins.Common.doTheBinding(u,A,g),!B.contains("tb_lb_wp_editor")&&u.data("control-binding")&&u.data("control-type")&&b.Views.init_control(u.data("control-type"),{el:u,binding_type:u.data("control-binding")}))}n&&setTimeout(function(){b.Utils.setColorPicker(g)},1);d[0].appendChild(g[0]);n&&(0<k.length&&setTimeout(function(){for(var a=0,c=k.length;a<c;++a)b.Views.init_control("wp_editor",
{el:k[a],binding_type:k[a].data("control-binding")});k=null},1),l&&b.Utils.builderPlupload("new_elemn"))},builderImportSubmit:function(a){a.preventDefault();var c=f(this);ThemifyBuilderCommon.LiteLightbox.confirm(themifyBuilder.i18n.dialog_import_page_post,function(a){f.ajax({type:"POST",url:themifyBuilder.ajaxurl,dataType:"json",data:{action:"builder_import_submit",nonce:themifyBuilder.tb_load_nonce,data:c.closest("form").serialize(),importType:"no"===a?"replace":"append",importTo:themifyBuilder.post_ID},
beforeSend:function(a){ThemifyBuilderCommon.showLoader("show")},success:function(a){b.Forms.reLoad(a,themifyBuilder.post_ID);ThemifyBuilderCommon.Lightbox.close()}})},{buttons:{no:{label:"Replace Existing Builder"},yes:{label:"Append Existing Builder"}}})},lightbox_switcher:function(a){a.preventDefault();a=f(a.currentTarget).attr("href").replace("#","");b.activeModel&&"visual"===b.mode&&(b.scrollTo=b.liveStylingInstance.$liveStyledElmt);f(".tb_breakpoint_switcher.breakpoint-"+a,top_iframe).trigger("click")},
reLoad:function(a,c){function d(){"visual"===b.mode&&(b.Utils.loadContentJs(),b.id=!1);b.vent.trigger("dom:builder:init");ThemifyBuilderCommon.showLoader("hide");"visual"===b.mode&&"desktop"!==b.activeBreakPoint&&(f("body",top_iframe).height(document.body.scrollHeight),setTimeout(function(){f("body",top_iframe).height(document.body.scrollHeight)},2E3))}b.Models.Registry.destroy();b.Instances.Builder={};var g="";if("visual"===b.mode){var e="themify-builder-"+c+"-generated-css",k=f("link#"+e),g="#themify_builder_content-"+
c;b.id=c;k.remove();void 0!==a.css&&void 0!==a.css.css_file&&(e="<link id="+e+' type="text/css" rel="stylesheet" href="'+a.css.css_file+"?tmp="+Date.now()+'" />',document.getElementById("themify-builder-admin-ui-css").insertAdjacentHTML("afterend",e));b.VisualCache=[];b.editing=!1;b.isComponentSaved=[];setTimeout(function(){b.liveStylingInstance.reset()},1);f("body").addClass("sidebar-none full_width")}else g="#themify_builder_row_wrapper";b.Instances.Builder[0]=new b.Views.Builder({el:g,collection:new b.Collections.Rows(a.builder_data),
type:"visual"});b.Instances.Builder[0].render();b.toolbar.undoManager.reset();"visual"===b.mode?b.bootstrap(null,d):d()},templateSelected:function(a){a.preventDefault();a.stopPropagation();var c=f(this).closest(".layout_preview");ThemifyBuilderCommon.LiteLightbox.confirm(themifyBuilder.i18n.confirm_template_selected,function(a){var d=themifyBuilder.post_ID,e={type:"POST",url:themifyBuilder.ajaxurl,dataType:"json",data:{action:"tb_set_layout",mode:"no"===a?1:0,nonce:themifyBuilder.tb_load_nonce,layout_slug:c.data("slug"),
id:d,layout_group:c.data("group")},beforeSend:function(){"visual"===b.mode&&ThemifyBuilderCommon.showLoader("show")},success:function(a){ThemifyBuilderCommon.Lightbox.close();"success"===a.status?b.Forms.reLoad(a,d):(ThemifyBuilderCommon.showLoader("error"),alert(a.msg))}};if("pre-designed"===c.data("group")){ThemifyBuilderCommon.showLoader("show");var k=c.data("slug"),h="https://themify.me/themify-layouts/"+k+".txt",l=function(){e.data.builder_data=b.layouts_selected[k];f.ajax(e)};if(!b.layouts_selected)b.layouts_selected=
{};else if(b.layouts_selected[k]){l();return}f.get(h,null,null,"text").done(function(a){b.layouts_selected[k]=a;l()}).fail(function(a,c,b){ThemifyBuilderCommon.LiteLightbox.alert("There was an error in loading layout, please try again later, or you can download this file: ("+h+") and then import manually (http://themify.me/docs/builder#import-export).")}).always(function(){ThemifyBuilderCommon.showLoader()})}else f.ajax(e)},{buttons:{no:{label:"Replace Existing Layout"},yes:{label:"Append Existing Layout"}}})},
saveAsLayout:function(a){a.preventDefault();f.ajax({type:"POST",url:themifyBuilder.ajaxurl,dataType:"json",data:{action:"tb_save_custom_layout",nonce:themifyBuilder.tb_load_nonce,form_data:f("#tb_save_layout_form",top_iframe).serialize()},success:function(a){"success"===a.status?ThemifyBuilderCommon.Lightbox.close():alert(a.msg)}})},widget_actions:function(){var a={},c=!1,d=!1,g=!1;f("body",top_iframe).on("change","#class_widget",function(){var e=f(this).val(),k=f(this).find(" :selected").data("idbase"),
h=c["widget-id"],l=function(k,h){var l=f("#instance_widget",top_iframe),n=f(h.form),u=function(a){"text"===a?d||(d=!0,wp.textWidgets.init()):g||(wp.mediaWidgets.init(),g=!0);f(document).trigger("widget-added",[l]);"text"===a&&b.Views.init_control("wp_editor",{el:l.find(".wp-editor-area"),binding_type:"refresh"})},p=function(a,c,b){var d=a.length;(function(a,c,b){Themify.LoadAsync(a,c,null,null,b)})(a[c],function(){++c;c<d?p(a,c,b):u(b)})};if(c)for(var t in c)n.find('[name="'+t+'"]').val(c[t]);n.find(".widget-id").val(Math.random());
n.find("select").wrap('<span class="selectwrapper"/>');l.html(n.html());void 0===a[k]&&h.template?(document.getElementsByTagName("body")[0].insertAdjacentHTML("beforeend",h.template),0<h.src.length&&p(h.src,0,k)):h.init&&u(k,h.form);"visual"===b.mode&&e&&l.find(":input").first().trigger("change")};q.class_widget=e;void 0!==a[k]&&h===a[k].widgetID?l(k,a[k]):f.ajax({type:"POST",dataType:"json",url:themifyBuilder.ajaxurl,data:{action:"module_widget_get_form",tb_load_nonce:themifyBuilder.tb_load_nonce,
load_class:e,tpl_loaded:+(0<f("#tmpl-media-modal").length),id_base:k,widget_instance:c},success:function(c){c&&c.form&&(l(k,c),a[k]={form:c.form,init:0<c.src.length,widgetID:h})}})});f("body").on("editing_module_option",function(a,b,d,g){"widget"===b&&d.instance_widget&&(c=d.instance_widget,setTimeout(function(){f("#class_widget",g).trigger("change");c=!1},200))})},isValidate:function(a){var c=a.find("[data-validation]");if(0===c.length)return!0;var b=this,g={};c.each(function(){var a=f(this),c=a.data("validation"),
d=a.val();b.checkValidate(c,d)||(g[a.prop("id")]=a.data("error-msg"))});a.find(".tb_field_error").removeClass("tb_field_error").end().find(".tb_field_error_msg").remove();if(_.isEmpty(g))return!0;var e=0;_.each(g,function(c,b){var d=a.find("#"+b);d.addClass("tb_field_error");f("<span/>",{"class":"tb_field_error_msg","data-error-key":b}).text(c).insertAfter(d);e||(d=a.children().index(d.closest(".themify_builder_options_tab_wrapper")),(d=-1<d&&a.closest("#themify_builder_lightbox_parent").find(".themify_builder_options_tab > li").eq(d))&&
!d.hasClass("current")&&d.trigger("click"),e++)});return!1},checkValidate:function(a,c){return b.Forms.get_validator(a)(c)},clear:function(){if(b.activeModel&&(void 0!==b.activeModel.get("is_new")&&b.activeModel.trigger("dom:module:unsaved"),b.activeModel=null,void 0!==tinyMCE))for(var a=tinymce.editors.length-1;-1<a;a--)"content"!==tinymce.editors[a].id&&tinyMCE.execCommand("mceRemoveEditor",!0,tinymce.editors[a].id)}};b.Forms.register_validator=function(a,c){this.Validators[a]=c};b.Forms.get_validator=
function(a){return void 0!==this.Validators[a]?this.Validators[a]:this.Validators.not_empty};b.Forms.register_validator("email",function(a){var c=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;a=a.split(",");return!(0<f.map(a,function(a,b){return c.test(a)?null:"1"}).length)});b.Forms.register_validator("not_empty",function(a){return!(!a||""===a.trim())});b.Views.Toolbar=Backbone.View.extend({events:{"click .tb_import":"import",
"click .themify_builder_load_layout":"loadLayout","click .themify_builder_save_layout":"saveLayout","click .themify_builder_dup_link":"duplicate","click .tb_toolbar_save":"save","click .tb_toolbar_backend_edit a":"save","click .tb_toolbar_close_btn":"panelClose","click .tb_breakpoint_switcher":"breakpointSwitcher","click .themify_builder_zoom":"zoom","click .tb_toolbar_zoom_menu_toggle":"zoom","click .tb_toolbar_builder_preview":"previewBuilder"},initialize:function(){var a=[],c=this,d=this.$el.find(".tb_module_panel_modules_wrap"),
g=wp.template("builder_module_item_draggable"),e;for(e in themifyBuilder.modules)a.push(g({slug:e,name:themifyBuilder.modules[e].name,type:themifyBuilder.modules[e].type?themifyBuilder.modules[e].type:"",favorite:+themifyBuilder.modules[e].favorite}));d[0].innerHTML=a.join("")+'<span class="favorite-separator"></span>';f("#tmpl-builder_module_item_draggable").remove();"visual"===b.mode&&f("body",top_iframe)[0].appendChild(this.el);a=null;setTimeout(function(){c.Panel.init();c.undoManager.init();"visual"===
b.mode?(window.top.jQuery("body").one("themify_builder_ready",function(a){new SimpleBar(d[0])}),c.unload()):new SimpleBar(d[0]);c.preDesignedRows.init()},1);setTimeout(function(){c.Revisions.init()},800);f("body",top_iframe).on("click",".themify_module_favorite",c.toggleFavoriteModule);if("visual"===b.mode)f("body").on("click",".themify_module_favorite",c.toggleFavoriteModule)},"import":function(a){a.preventDefault();a=ThemifyBuilderCommon.detectBuilderComponent(f(a.currentTarget));var c=null,d={dataType:"html",
data:{action:"builder_import",type:a}};if("file"!==a||confirm(themifyBuilder.i18n.importFileConfirm))"file"===a&&(c=function(){b.Utils.builderPlupload("",!0)}),ThemifyBuilderCommon.Lightbox.open(d,null,c)},unload:function(){var a=this;"visual"===b.mode&&document.getElementsByTagName("head")[0].insertAdjacentHTML("afterbegin",'<base target="_parent">');window.top.onbeforeunload=function(){return!b.editing&&a.undoManager.hasUndo()?"Are you sure":null}},panelClose:function(a){a.preventDefault();window.parent.location.reload(!0)},
undoManager:{stack:[],is_working:!1,index:-1,btnUndo:document.getElementsByClassName("tb-undo-btn")[0],btnRedo:document.getElementsByClassName("tb-redo-btn")[0],init:function(){var a=this;b.toolbar.$el.find(".tb-undo-redo").on("click",this.do_change.bind(this));if(!themifyBuilder.disableShortcuts&&(f(top_iframe).on("keydown",this.keypres.bind(this)),"visual"===b.mode))f(document).on("keydown",this.keypres.bind(this));b.vent.on("dom:change",function(c,d,g,e,k){b.editing=!1;g&&(g=ThemifyBuilderCommon.Lightbox.clone(g));
"visual"!==b.mode||"duplicate"!==e&&"sort"!==e||f(window).trigger("tfsmartresize.tfVideo");a.stack.splice(a.index+1,a.stack.length-a.index);a.stack.push({cid:c,type:e,data:k,before:d,after:g});a.index=a.stack.length-1;a.updateUndoBtns();"visual"===b.mode&&f("body").trigger("builder_dom_changed",[e])})},set:function(a){var c=a[0].querySelectorAll("[data-cid]"),c=Array.prototype.slice.call(c);c.unshift(a[0]);a=0;for(var d=c.length;a<d;++a){var g=b.Models.Registry.lookup(c[a].getAttribute("data-cid"));
g&&g.trigger("change:view",c[a])}},doScroll:function(a){("visual"!==b.mode||"desktop"===b.activeBreakPoint?f("body"):f("body",top_iframe)).scrollTop(a.offset().top)},keypres:function(a){if(90===a.which&&"INPUT"!==document.activeElement.tagName&&"TEXTAREA"!==document.activeElement.tagName)if(!0===a.ctrlKey&&!0===a.shiftKey||!0===a.metaKey&&!0===a.shiftKey)a.preventDefault(),this.hasRedo()&&this.changes(!1);else if(!0===a.ctrlKey||!0===a.metaKey)a.preventDefault(),this.hasUndo()&&this.changes(!0)},
changes:function(a){var c=this.stack[this.index+(a?0:1)];if(void 0!==c){this.is_working=!0;var d="";var g=c.type,e=f(".tb_element_cid_"+c.cid);var k=!1;if("row"===g)a?(d=c.before.clone(!0),k=c.cid):(d=c.after.clone(!0),k=c.before.data("cid"),e=f(".tb_element_cid_"+k)),this.set(d),e.replaceWith(d);else if("duplicate"===g)a?f(".tb_element_cid_"+c.after.data("cid")).remove():(d=c.after.clone(!0),k=c.before.data("cid"),this.set(d),e.after(d));else if("delete_row"===g)a?(d=c.before.clone(!0),k=c.cid,e=
f(".tb_element_cid_"+c.data.pos_cid),this.set(d),"after"===c.data.pos?e.after(d):e.before(d)):e.remove();else if("sort"===g)k=c.cid,a?(e=c.data.after,g=c.data.before,d=c.before.clone(!0)):(e=c.data.before,g=c.data.after,d=c.after.clone(!0),"visual"===b.mode&&d.find(".active_module").css({display:"block",height:"auto"})),this.set(d),f(".tb_element_cid_"+e).find(".tb_element_cid_"+k).remove(),f(".tb_element_cid_"+g).replaceWith(d);else if("save"===g){k=c.cid;var g=b.Models.Registry.lookup(k),h="module"===
g.get("elType"),l={},n=h?"mod_settings":"styling";h&&c.data.column?a?(k=!1,e.remove()):(k=c.data.column.data("cid"),d=c.data.column.clone(!0),e=f(".tb_element_cid_"+k),this.set(d),e.replaceWith(d)):(a?(l[n]=c.data.old,d=c.before.clone(!0)):(l[n]=c.data["new"],d=c.after.clone(!0)),g.set(l,{silent:!0}),this.set(d),e.replaceWith(d),"visual"===b.mode&&b.liveStylingInstance.doUndo(c.data.styles,a?c.data.first:!1))}else if("predesign"===g)if(e=c.data.rows,a)for(g=0,h=e.length;g<h;++g)f(".tb_element_cid_"+
e[g].data("cid")).remove();else{l=document.createDocumentFragment();d=[];g=0;for(h=e.length;g<h;++g)n=ThemifyBuilderCommon.Lightbox.clone(e[g]),l.appendChild(n[0]),d.push(n);!1!==c.data.prev?f(".tb_element_cid_"+c.data.prev).after(l):f("#themify_builder_content-"+c.data.bid).prepend(l);g=0;for(h=d.length;g<h;++g)this.set(d[g]),b.Mixins.Builder.update(d[g])}else if("import"===g){var e=f('[data-postid="'+c.data.bid+'"]'),c=a?c.data.before.clone(!0):c.data.after.clone(!0),t=this;e.children().remove();
e.prepend(c);c.each(function(){t.set(f(this))})}k&&b.Mixins.Builder.update(d);a?this.index--:this.index++;this.is_working=!1;this.updateUndoBtns()}},hasRedo:function(){return this.index<this.stack.length-1},hasUndo:function(){return-1!==this.index},disable:function(){this.btnUndo.classList.add("tb_disabled");this.btnRedo.classList.add("tb_disabled")},updateUndoBtns:function(){this.hasUndo()?this.btnUndo.classList.remove("tb_disabled"):this.btnUndo.classList.add("tb_disabled");this.hasRedo()?this.btnRedo.classList.remove("tb_disabled"):
this.btnRedo.classList.add("tb_disabled")},reset:function(){this.stack=[];this.index=-1;this.updateUndoBtns()},do_change:function(a){a.preventDefault();!1===this.is_working&&-1===a.currentTarget.className.indexOf("tb_disabled")&&this.changes(-1!==a.currentTarget.className.indexOf("tb-undo-btn"))}},loadLayout:function(a){function c(a){a.each(function(a){0===a%4?f(this).addClass("layout-column-break"):f(this).removeClass("layout-column-break")})}a.preventDefault();var b=this;ThemifyBuilderCommon.Lightbox.open(b.layouts_list?
{loadMethod:"html",data:b.layouts_list}:{data:{action:"tb_load_layout"}},null,function(a){function d(){var a=g.find(".layout_preview_list");h.show().find("a").on("click",function(b){b.preventDefault();f(this).hasClass("selected")||(b=a,f(this).hasClass("all")||(a.hide(),b=a.filter('[data-category*="'+f(this).text()+'"]')),b.show(),c(b),h.find("a").removeClass("selected"),f(this).addClass("selected"),h.parent().find(".tb_filter_layouts").html(f(this).text()))});g.find("#themify_builder_layout_search").on("keyup",
function(){var b=f.trim(f(this).val()),d=a;""!==b&&(d=h.find("a.all"),d.hasClass("selected")||d.click(),a.hide(),d=a.find(".layout_title:contains("+b+")").closest(".layout_preview_list"));d.show();c(d)})}a=f(a);var g=a.find("#themify_builder_tabs_pre-designed"),h=g.find("#themify_builder_pre-designed-filter");0!=g.length&&(b.layouts_list?d():(ThemifyBuilderCommon.showLoader("show"),f.getJSON("https://themify.me/themify-layouts/index.json").done(function(e){var k=window.top.wp.template("themify-builder-layout-item"),
l={},m="";e=f(k(e));e.find("li").each(function(){for(var a=f(this).data("category").split(","),c=0,b=a.length;c<b;++c)""!==a[c]&&void 0===l[a[c]]&&(m+='<li><a href="#">'+a[c]+"</a></li>",l[a[c]]=1)});l=null;h[0].insertAdjacentHTML("beforeend",m);g[0].insertAdjacentHTML("beforeend",e[0].outerHTML);a.find(".themify_builder_tab").each(function(){c(f(this).find(".layout_preview_list"))});b.layouts_list=a[0];d();new SimpleBar(a[0])}).fail(function(a,c,b){ThemifyBuilderCommon.LiteLightbox.alert(f("#themify_builder_load_layout_error",
g).show().text())}).always(function(){ThemifyBuilderCommon.showLoader("spinhide")})))})},saveLayout:function(a){a.preventDefault();ThemifyBuilderCommon.Lightbox.open({data:{action:"tb_custom_layout_form",postid:themifyBuilder.post_ID}},function(){b.Utils.builderPlupload("normal")})},duplicate:function(a){function c(){d.Revisions.ajax({action:"tb_duplicate_page",tb_is_admin:"visual"!==b.mode},function(a){a&&(window.top.location.href=f("<div/>").html(a).text())})}a.preventDefault();var d=this;confirm(themifyBuilder.i18n.confirm_on_duplicate_page)?
b.Utils.saveBuilder(c):c()},Revisions:{init:function(){b.toolbar.$el.find(".tb_revision").on("click",this.revision.bind(this));f("body",top_iframe).on("click",".js-builder-restore-revision-btn",this.restore.bind(this)).on("click",".js-builder-delete-revision-btn",this["delete"].bind(this))},revision:function(a){a.preventDefault();a.currentTarget.classList.contains("tb_save_revision")?this.save():this.load()},load:function(){ThemifyBuilderCommon.Lightbox.open({data:{action:"tb_load_revision_lists",
postid:themifyBuilder.post_ID,tb_load_nonce:themifyBuilder.tb_load_nonce}})},ajax:function(a,c){a=f.extend({},a,{tb_load_nonce:themifyBuilder.tb_load_nonce,postid:themifyBuilder.post_ID});return f.ajax({type:"POST",url:themifyBuilder.ajaxurl,data:a,beforeSend:function(){ThemifyBuilderCommon.showLoader("show")},complete:function(){ThemifyBuilderCommon.showLoader("hide")},success:function(a){f.isFunction(c)&&c.call(this,a)}})},save:function(a){var c=this;ThemifyBuilderCommon.LiteLightbox.prompt(themifyBuilder.i18n.enterRevComment,
function(d){null!==d&&b.Utils.saveBuilder(function(){c.ajax({action:"tb_save_revision",rev_comment:d},a)},"main",0,!0)})},restore:function(a){a.preventDefault();var c=f(a.currentTarget).data("rev-id"),d=this,g=function(){d.ajax({action:"tb_restore_revision_page",revid:c},function(a){a.status?(b.Forms.reLoad(a,themifyBuilder.post_ID),ThemifyBuilderCommon.Lightbox.close()):(ThemifyBuilderCommon.showLoader("error"),alert(a.data))})};ThemifyBuilderCommon.LiteLightbox.confirm(themifyBuilder.i18n.confirmRestoreRev,
function(a){"yes"===a?d.save(g):g()},{buttons:{no:{label:"Don't Save"},yes:{label:"Save"}}})},"delete":function(a){a.preventDefault();if(confirm(themifyBuilder.i18n.confirmDeleteRev)){var c=f(a.currentTarget);a=c.data("rev-id");this.ajax({action:"tb_delete_revision",revid:a},function(a){a.success?c.closest("li").remove():(ThemifyBuilderCommon.showLoader("error"),alert(a.data))})}}},save:function(a){a.preventDefault();a.stopPropagation();var c=0<f(a.currentTarget).closest(".tb_toolbar_backend_edit").length?
f(a.currentTarget).prop("href"):!1;b.Utils.saveBuilder(function(a,g){"success"!==g?alert(themifyBuilder.i18n.errorSaveBuilder):!1!==c&&("visual"===b.mode?(sessionStorage.setItem("focusBackendEditor",!0),window.top.location.href=c):(b.toolbar.undoManager.reset(),b._backendSwitchFrontend()))})},preDesignedRows:{is_init:null,rows:[],btn:null,filter_toolbar:null,filter_btn:null,clicked:null,init:function(){this.btn=f('<div class="tb_modules_panel_wrap" id="tb_plus_btn_popover"></div>');f("body").append(this.btn);
setTimeout(function(){document.getElementsByTagName("head")[0].insertAdjacentHTML("afterbegin",'<meta http-equiv="x-dns-prefetch-control" content="on"/><link href="//themify.me" rel="dns-prefetch preconnect"/><link href="//fonts.googleapis.com" rel="dns-prefetch"/><link href="//maps.google.com" rel="dns-prefetch"/><link href="https://themify.me/public-api/predesigned-rows/index.json" rel="prefetch"/>')},7E3);var a=this;this.btn.on("click",".add_module_btn",function(c){b.toolbar.Panel.add_module(c,
a.clicked.closest(".module_row").find(".themify_module_holder").last());a.clicked=null;a.btn.hide()}).on("keyup",".tb_module_panel_search_text",this.search.bind(this));if("visual"===b.mode)b.toolbar.$el.find(".tb_module_types a").on("click",this.tabs.bind(this));b.toolbar.$el.find(".tb_module_panel_search_text").on("keyup",this.search.bind(this));f("body").on("click",".tb_module_types a",this.tabs.bind(this)).on("click",".tb_row_btn_plus",this.show.bind(this));f(document).on("tb_setpredesignedrows",
this.get.bind(this))},load:function(a,c){if(null===this.is_init){this.is_init=!0;var d=this;a.addClass("tb_busy");f.getJSON("https://themify.me/public-api/predesigned-rows/index.json").done(function(b){d.setData(b,a,c)}).fail(function(a,c,d){this.is_init=null;ThemifyBuilderCommon.showLoader("error");b.toolbar.$el.find(".tb_predesigned_rows_list").html("<h3>Failed to load Pre-Designed Rows from server.</h3>")})}},setData:function(a,c,d){for(var g=[],e="",f="",h=0,l=a.length;h<l;++h){for(var n=a[h].category.split(","),
t="",m=0,w=n.length;m<w;++m)-1===g.indexOf(n[m])&&g.push(n[m]),t+=" tb"+Themify.hash(n[m]);if(void 0===a[h].thumbnail||""===a[h].thumbnail)a[h].thumbnail="https://placeholdit.imgix.net/~text?txtsize=24&txt="+encodeURI(a[h].title)+"&w=181&h=77";f+='<div class="predesigned_row'+t+'" data-slug="'+a[h].slug+'"><figure class="tb_predesigned_rows_list_image">';f+='<img alt="'+a[h].title+'" title="'+a[h].title+'" src="'+a[h].thumbnail+'" /></figure>';f+='<div class="tb_predesigned_rows_list_title">'+a[h].title+
"</div></div>"}a=null;g.sort();h=0;for(l=g.length;h<l;++h)e+='<li><a href="#" data-slug="'+Themify.hash(g[h])+'">'+g[h]+"</li>";b.toolbar.$el.find(".tb_row_filter")[0].insertAdjacentHTML("beforeend",e);var u=b.toolbar.$el.find(".tb_predesigned_rows_list");u[0].insertAdjacentHTML("beforeend",f);this.btn[0].insertAdjacentHTML("beforeend",b.toolbar.$el.find("#tb_module_panel")[0].innerHTML);this.btn.find(".tb_module_panel_lock").remove();this.btn.find(".themify_builder_module_outer").show();this.btn.find(".tb_module_panel_search_text").val("");
var p=this;u.find("img").last().one("load",function(){p.filter();"visual"===b.mode?b.Mixins.Builder.initRowVisualDrag():b.Mixins.Builder.initRowDraggable(b.toolbar.$el);c.removeClass("tb_busy");new SimpleBar(u[0]);new SimpleBar(p.btn.find(".tb_module_panel_modules_wrap")[0]);new SimpleBar(p.btn.find(".tb_predesigned_rows_list")[0]);b.Mixins.Builder.initModuleDraggable(p.btn);b.Mixins.Builder.initRowDraggable(p.btn);"function"===typeof d&&d()})},get:function(a,c,b){ThemifyBuilderCommon.showLoader("show");
if(void 0!==this.rows[c])"function"===typeof b&&b(this.rows[c]);else{var d=this;f.getJSON("https://themify.me/public-api/predesigned-rows/"+c+".txt").done(function(a){d.rows[c]=a;"function"===typeof b&&b(a)}).fail(function(a,c,b){ThemifyBuilderCommon.showLoader("error");alert("Failed to fetch row template")})}},tabs:function(a){a.preventDefault();a.stopPropagation();a=f(a.currentTarget);var c=a.data("target"),b=a.closest(".tb_modules_panel_wrap");null===this.is_init&&this.load(b);b.find("."+c).show().siblings(".tb_module_panel_tab").hide();
a.closest("li").addClass("active").siblings().removeClass("active");b.find(".tb_module_panel_search_text").val("")},show:function(a){function c(){"visual"===b.mode&&"desktop"!==b.activeBreakPoint&&(f("body",top_iframe).height(document.body.scrollHeight+d.btn.outerHeight(!0)),f("body").css("padding-bottom",180))}a.preventDefault();a.stopPropagation();var d=this;this.clicked=f(a.currentTarget);a=this.clicked.offset();var g=b.toolbar.Panel.is_locked&&"visual"===b.mode?b.toolbar.$el.find("#tb_module_panel").outerWidth():
0;this.btn.css({top:a.top,left:a.left-this.btn.width()/2+11-g}).show();null===this.is_init?this.load(this.btn,c):c();this.hide()},hide:function(){function a(d){c.btn.is(":hover")||(c.btn.hide(),c.clicked=null,f(document).off("click",a),f(top_iframe).off("click",a),"visual"===b.mode&&"desktop"!==b.activeBreakPoint&&(f("body",top_iframe).height(document.body.scrollHeight),f("body").css("padding-bottom","")))}var c=this;if("visual"===b.mode)f(top_iframe).on("click",a);f(document).on("click",a)},search:function(a){a=
f(a.currentTarget);var c=a.closest(".tb_modules_panel_wrap"),b="tb_module_panel_modules_wrap"===c.find(".tb_module_types .active a").data("target"),g=!b&&this.is_init?"tb_module_panel"===c.prop("id")?this.filter_toolbar:this.filter_btn:!1,c=b?c.find(".themify_builder_module_outer"):this.is_init?c.find(".predesigned_row"):!1;a=f.trim(a.val());if(!1!==c){var e=""===a,k=e?!1:new RegExp(a,"i");c.each(function(){if(g&&!f(this).hasClass(g))return!0;var a=b?f(this).find(".module_name"):f(this).find(".tb_predesigned_rows_list_title");
e||k.test(a.text())?f(this).show():f(this).hide()})}},filter:function(){function a(a){a.preventDefault();a.stopPropagation();a=f(a.currentTarget);var c=a.data("slug"),b=a.closest(".tb_modules_panel_wrap"),e=b.find(".tb_row_filter_active"),k=b.find(".predesigned_row");e.text(a.text());b.find(".tb_module_panel_search_text").val("");if(c){var h="tb"+c;k.each(function(){f(this).hasClass(h)?f(this).show():f(this).hide()})}else k.show();"tb_module_panel"===b.prop("id")?this.filter_toolbar=h:this.filter_btn=
h}b.toolbar.$el.find(".tb_row_filter").on("click","a",a.bind(this));this.btn.find(".tb_row_filter").on("click","a",a.bind(this))}},breakpointSwitcher:function(a){function c(){g.responsive_grids(e,h);"visual"===b.mode&&l.css("will-change","auto");k.toggleClass("tb_responsive_mode","desktop"!==e).removeClass("builder-breakpoint-"+h).addClass("builder-breakpoint-"+e);f("body").trigger("themify_builder_change_mode",[h,e]);"visual"===b.mode?(b.Mixins.Builder.updateModuleSort(null,"desktop"===e?"enable":
"disable"),b.Utils._onResize(!0,function(){g.iframeScroll("desktop"!==e);f("body",top_iframe).height("desktop"!==e?document.body.scrollHeight:"auto");b.scrollTo&&setTimeout(function(){f(window).add(top_iframe).scrollTop(b.scrollTo.offset().top);b.scrollTo=!1},500);setTimeout(function(){b.Utils.setCompactMode(document.getElementsByClassName("module_column"));k.removeClass("tb_start_animate")},200)})):k.removeClass("tb_start_animate")}a.preventDefault();var d="",g=this,e="desktop";a=f(a.currentTarget);
var k=f("body",top_iframe),h=b.activeBreakPoint;a.hasClass("breakpoint-tablet")?e="tablet":a.hasClass("breakpoint-tablet_landscape")?e="tablet_landscape":a.hasClass("breakpoint-mobile")&&(e="mobile");if(h===e)return!1;b.activeBreakPoint=e;"visual"===b.mode&&(k=k.add("body"));k.addClass("tb_start_animate");"desktop"!==e&&(d=b.Utils.getBPWidth(e)-1);if("visual"===b.mode){var l=f("#themify_builder_site_canvas_iframe",top_iframe);f(".tb_toolbar_zoom_menu",top_iframe).removeClass("tb_toolbar_zoom_active").find(".tb_toolbar_zoom_menu_toggle").data("zoom",
100);l.css("will-change","width").one(b.Utils.transitionPrefix(),c).css("width",d).parent().removeClass("themify_builder_zoom_bg")}else c()},iframeScroll:function(a){var c=f(top_iframe);c.off("scroll.themifybuilderresponsive");if(a)c.on("scroll.themifybuilderresponsive",function(){window.scrollTo(0,f(this).scrollTop())})},responsive_grids:function(a,c){var b=document.querySelectorAll(".row_inner,.subrow_inner");"tablet_landscape"===a&&(a="tablet");for(var g="desktop"===a,e=g||"desktop"===c,k="tablet"===
a?"mobile":"tablet",h=0,l=b.length;h<l;++h){var n=b[h].getAttribute("data-basecol");if(n){var t=b[h].children,m=b[h].dataset["col_"+a],w=t[0],u=t[t.length-1];if(!g){var p=b[h].getAttribute("data-col_"+k);b[h].classList.remove("tb_3col");p&&b[h].classList.remove(f.trim(p.replace("tb_3col","").replace("mobile","column").replace("tablet","column")));if(m&&"-auto"!==m){if(m=b[h].getAttribute("data-col_"+a)){b[h].classList.add("tb_grid_classes");b[h].classList.add("col-count-"+n);var m=m.split(" "),q;
for(q in m)b[h].classList.add(f.trim(m[q].replace("mobile","column").replace("tablet","column")))}}else b[h].classList.remove("tb_grid_classes"),b[h].classList.remove("col-count-"+n)}if(e)for(n=0,m=t.length;n<m;++n)p=f(t[n]).data("w"),void 0!==p&&(t[n].style.width=g?p+"%":"");"rtl"===b[h].getAttribute("data-"+a+"_dir")?(w.classList.remove("first"),w.classList.add("last"),u.classList.remove("last"),u.classList.add("first"),b[h].classList.add("direction-rtl")):(w.classList.remove("last"),w.classList.add("first"),
u.classList.remove("first"),u.classList.add("last"),b[h].classList.remove("direction-rtl"))}}},Panel:{el:null,is_locked:!1,key:"tb_module_panel_locked",init:function(){this.el=b.toolbar.$el.find(".tb_toolbar_add_modules_wrap");this.el.blur().hover(this.toogle.bind(this)).find(".tb_module_panel_lock").on("click",this.lock.bind(this));this._setupModulePanelState();this.el.find(".add_module_btn").on("click",this.add_module)},add_module:function(a,c){a.preventDefault();a.stopPropagation();c=c||b.Instances.Builder[0].$el.find(".module_row").last().find(".themify_module_holder").first();
var d=c.offset().top-37;"visual"===b.mode?"desktop"!==b.activeBreakPoint&&f(top_iframe).scrollTop(d):d-=50;f(window).scrollTop(d);b.Mixins.Builder.moduleDrop(f(a.currentTarget).closest(".themify_builder_module"),c)},resetPanel:function(){this.el.removeClass("tb_disabled");this.is_locked&&this.toggleLock()},toogle:function(a){this.is_locked||this.el.hasClass("tb_disabled")||f(a.currentTarget).focus()},lock:function(a){a.preventDefault();this.is_locked=!this.is_locked;localStorage.setItem(this.key,
this.is_locked);this.toggleLock();if(!this.is_locked){this.el.addClass("tb_hide_panel");var c=this;setTimeout(function(){b.toolbar.$el.find("#themify_builder_switch_backend").focus();c.el.removeClass("tb_hide_panel")},1E3)}},toggleLock:function(){var a=b.toolbar.$el;"visual"===b.mode&&(a=a.add(f("body")),a.addClass("tb_remove_transitions"));f("body",top_iframe).toggleClass("tb_module_panel_locked");f(window).trigger("tfsmartresize");a.removeClass("tb_remove_transitions")},_setupModulePanelState:function(){this.is_locked=
localStorage.getItem(this.key);"false"===this.is_locked&&(this.is_locked=!1);if(this.is_locked){var a=this;setTimeout(function(){a.toggleLock()},1200)}},hide:function(){this.el.blur();this.resetPanel();this.el.addClass("tb_disabled")},show:function(){this.is_locked||this.el.focus()}},toggleFavoriteModule:function(){var a=f(this),c=a.closest(".themify_builder_module_outer"),d=a.parent().data("module-slug");f.ajax({type:"POST",url:themifyBuilder.ajaxurl,dataType:"json",data:{action:"tb_module_favorite",
module_name:d,module_state:+!c.hasClass("favorited")},beforeSend:function(a){function e(a,c){function k(){a.removeAttr("style");if(c){var g=0<a.closest("#tb_plus_btn_popover").length?b.toolbar.$el:f("#tb_plus_btn_popover");e(g.find(".module-type-"+d).closest(".themify_builder_module_outer"),!1)}}if(a.is(":visible"))a.css({opacity:0,transform:"scale(0.5)"}).one(g,function(){a.toggleClass("favorited").css({opacity:1,transform:"scale(1)"}).one(g,k)});else a.toggleClass("favorited"),k()}var g=b.Utils.transitionPrefix();
e(c,!0)}})},zoom:function(a){a.preventDefault();if("desktop"!==b.activeBreakPoint)return!0;var c=f(a.currentTarget);a=c.data("zoom");var d=f(".themify_builder_site_canvas_iframe",top_iframe),g=c.closest(".tb_toolbar_zoom_menu");c.hasClass("tb_toolbar_zoom_menu_toggle")?(a="100"==a?50:100,c.data("zoom",a),c=c.next("ul").find('[data-zoom="'+a+'"]')):g.find(".tb_toolbar_zoom_menu_toggle").data("zoom",a);d.removeClass("themify_builder_zooming_50 themify_builder_zooming_75");c.parent().addClass("selected-zoom-size").siblings().removeClass("selected-zoom-size");
"50"==a||"75"==a?(c="50"==a?2:1.25,d.addClass("themify_builder_zooming_"+a).parent().addClass("themify_builder_zoom_bg").css("height",Math.max(window.top.innerHeight*c,600)),g.addClass("tb_toolbar_zoom_active"),b.zoomMeta.isActive=!0,b.zoomMeta.size=a,f("body").addClass("tb-zoom-only")):(d.addClass("themify_builder_zooming_"+a).parent().css("height",""),g.removeClass("tb_toolbar_zoom_active"),b.zoomMeta.isActive=!1,f("body").removeClass("tb-zoom-only"))},previewBuilder:function(a){a.preventDefault();
f(a.currentTarget).toggleClass("tb_toolbar_preview_active");b.isPreview=!b.isPreview;f("body").toggleClass("tb-preview-only themify_builder_active");f("body",top_iframe).toggleClass("tb-preview-parent");b.isPreview?this.Panel.hide():this.Panel.resetPanel();(function(){b.isPreview?f(".col-count-1.row_inner").each(function(){if(0===this.getElementsByClassName("active_module").length){var a=this.getElementsByClassName("module_column")[0];if((a=b.Models.Registry.lookup(a.dataset.cid))&&0===Object.keys(a.get("styling")).length){var a=
f(this).closest(".module_row"),d=b.Models.Registry.lookup(a.data("cid"));d&&0===Object.keys(d.get("styling")).length&&a.addClass("tb-hide")}}}):f(".tb-hide.module_row").removeClass("tb-hide")})();b.vent.trigger("dom:preview")}});b.Views.bindEvents=function(){ThemifyBuilderCommon.Lightbox.setup();ThemifyBuilderCommon.LiteLightbox.modal.on("attach",function(){this.$el.addClass("themify_builder_lite_lightbox_modal")});b.Utils.mediaUploader();b.Utils.openGallery()};b.Utils={onResizeEvents:[],gridClass:"col-full col4-1 col4-2 col4-3 col3-1 col3-2 col6-1 col5-1".split(" "),
_onResize:function(a,c){var d=f._data(window,"events").resize;if(""===tbLocalScript.fullwidth_support)f(window.top).off("tfsmartresize.tb_visual").on("tfsmartresize.tb_visual",function(a){f(window).trigger("tfsmartresize.tbfullwidth").trigger("tfsmartresize.tfVideo")});f(window.top).off("tfsmartresize.zoom").on("tfsmartresize.zoom",function(){if(b.zoomMeta.isActive){var a="50"==b.zoomMeta.size?2:1.25;f(".themify_builder_workspace_container",top_iframe).css("height",Math.max(window.top.innerHeight*
a,600))}});if(void 0!==d)for(var g=0,e=d.length;g<e;++g)void 0!==d[g].handler&&this.onResizeEvents.push(d[g].handler);f(window).off("resize");if(a){d=f.Event("resize",{type:"resize",isTrigger:!1});g=0;for(e=this.onResizeEvents.length;g<e;++g)try{this.onResizeEvents[g].apply(window,[d,f])}catch(k){}"function"===typeof c&&c()}},_addNewColumn:function(a,c){var d=b.Views.init_column({grid_class:a.newclass,component_name:a.component},a.type);c.append(d.view.render().$el)},filterClass:function(a){a=a.split(" ");
for(var c=[],b=0,f=a.length;b<f;++b)-1!==this.gridClass.indexOf(a[b])&&c.push(a[b]);return c.join(" ")},_getRowSettings:function(a,c,d){var g={};d=d||"row";var e={};var k=b.Models.Registry.lookup(a.dataset.cid);if(k){a=a.getElementsByClassName(d+"_inner")[0];e=a.children;d=0;for(var h=e.length;d<h;++d){var l=b.Models.Registry.lookup(e[d].dataset.cid);if(l){var n=e[d].getElementsByClassName("themify_module_holder");var t={};if(0<n.length){n=n[0].children;for(var m=0,w=n.length;m<w;++m){var u=b.Models.Registry.lookup(n[m].dataset.cid);
if(u){var p=b.Utils.clear(u.get("mod_settings"),!0);t[m]={mod_name:u.get("mod_name")};0<Object.keys(p).length&&(t[m].mod_settings=p);-1!==n[m].className.indexOf("module_subrow")&&(t[m]=this._getRowSettings(n[m],m,"subrow"))}}}g[d]={column_order:d,grid_class:this.filterClass(e[d].className)};0<Object.keys(t).length&&(g[d].modules=t);p=parseFloat(e[d].style.width);0<p&&!isNaN(p)&&(g[d].grid_width=p);p=b.Utils.clear(l.get("styling"),!0);0<Object.keys(p).length&&(g[d].styling=p)}}e={row_order:c,cols:g,
column_alignment:k.get("column_alignment"),gutter:k.get("gutter")};g={gutter:"gutter-default",column_alignment:"col_align_top"};c={desktop_dir:"ltr",tablet_dir:"ltr",mobile_dir:"ltr",col_tablet:"-auto",col_mobile:"-auto"};for(d in e)""!==e[d]&&e[d]!==g[d]||delete e[d];p=b.Utils.clear(k.get("styling"),!0);for(d in c)k=f.trim(a.getAttribute("data-"+d)),void 0!==k&&""!==k&&k!==c[d]&&(e[d]=k);0<Object.keys(p).length&&(e.styling=p)}return e},selectedGridMenu:function(a){for(var c,d,g,e,k=a.getElementsByClassName("grid_menu"),
h=["mobile","tablet","desktop"],l=0,n=k.length;l<n;++l)if(a=f(k[l]),c=a.data("handle"),"module"!==c){d=a.closest(".module_"+c);g=b.Models.Registry.lookup(d.data("cid"));var t=[];c=d.find("."+c+"_inner").first();var m=g.get("gutter"),w=g.get("column_alignment");e=g.get("desktop_dir");for(var u=g.get("styling"),p="",q={},x=c[0].children,r=0,z=x.length;r<z;++r)t.push(b.Utils._getColClass(x[r].className.split(" "))),x[r].className=x[r].className.replace(/first|last/ig,""),1!==z&&(0===r?x[r].className+=
"rtl"===e?" last":" first":r===z-1&&(x[r].className+="rtl"===e?" first":" last"));t=a.find(".themify_builder_grid_desktop .grid-layout-"+t.join("-"));r=t.data("col");0<t.length&&(t.parent().addClass("selected").siblings().removeClass("selected"),d.addClass("col-count-"+r),p="col-count-"+r,q["data-basecol"]=r);"ltr"!==e&&(p+=" direction-rtl");for(r=0;3>r;++r)e=g.get(h[r]+"_dir"),"ltr"!==e&&""!==e&&(q["data-"+h[r]+"_dir"]=e,t=a.find(".themify_builder_grid_"+h[r]+" .column-dir-"+e),t.parent().addClass("selected").siblings().removeClass("selected")),
"desktop"!==h[r]&&(e=g.get("col_"+h[r]),"-auto"!==e&&""!==e&&void 0!==e&&(q["data-col_"+h[r]]=e,t=a.find(".themify_builder_grid_"+h[r]+" .grid-layout-"+e.replace(/column|tb_3col/ig,"")),t.parent().addClass("selected").siblings().removeClass("selected")));u&&void 0!==u.row_anchor&&""!==u.row_anchor&&d.find(".row-anchor-name").first().text(u.row_anchor);"col_align_top"!==w&&(a.find(".column-alignment-"+w).parent().addClass("selected").siblings().removeClass("selected"),p+=" "+w);"gutter-default"!==
m&&(a.find(".gutter_select").val(m),p+=" "+m);c.addClass(p).attr(q)}},clear:function(a,c,b){b=b?[]:{};for(var d in a)if(Array.isArray(a[d])){var e=this.clear(a[d],c,!0);0<e.length&&(b[d]=e)}else if("object"===typeof a[d])e=this.clear(a[d],c,!1),f.isEmptyObject(e)||(b[d]=e);else if(a[d]&&"px"!==a[d]&&"pixels"!==a[d]&&"solid"!==a[d]&&"linear"!==a[d]&&"default"!==a[d]&&"|"!==a[d]&&!(-1!==d.indexOf("_gradient-css")||"cover_gradient_hover-css"===d||"background_image-css"===d||"background_image-type_gradient"===
d||d.indexOf("gradient-angle")&&"180"==a[d]||-1!==d.indexOf("_padding_apply_all_padding")||-1!==d.indexOf("_margin_apply_all_margin")||-1!==d.indexOf("_border_apply_all_border")||"text_align_right"===d||"text_align_center"===d||"text_align_left"===d||"text_align_justify"===d||"show"===a[d]&&-1!==d.indexOf("visibility_"))){if(c&&("cover_gradient_hover-gradient"===d||"background_image-gradient"===d||-1===d.indexOf("gradient-angle")&&-1!==d.indexOf("_gradient-gradient"))&&(e=-1!==d.indexOf("background_gradient")?
d.replace("_gradient","_type").replace("-gradient",""):d.replace("-gradient","-type").replace("_gradient","_color"),"gradient"!==a[e]&&"cover_gradient"!==a[e]&&"hover_gradient"!==a[e])){e=["gradient-angle","type_image","circle-radial","gradient-type"];for(var k=d.replace("-gradient",""),h=0,l=e.length;h<l;++h){var n=k+"-"+e[h];void 0!==a[n]&&(a[n]=b[n]=null,delete a[n],delete b[n])}continue}b[d]=a[d]}return b},builderPlupload:function(a,c){var d=f(".themify-builder-plupload-upload-uic"+(c?"":"new_elemn"===
a?".plupload-clone":""),top_iframe);if(0<d.length){var g=this;void 0===g.pconfig&&(g.pconfig=JSON.parse(JSON.stringify(themify_builder_plupload_init)),g.pconfig.multipart_params._ajax_nonce=themifyBuilder.tb_load_nonce,g.pconfig.multipart_params.topost=themifyBuilder.post_ID);d.each(function(){var a=f(this),d=a.prop("id").replace("themify-builder-plupload-upload-ui",""),h=f.extend(!0,{},g.pconfig),l=["browse_button","container","drop_element","file_data_name"];h.multipart_params.imgid=d;for(var n=
0,t=l.length;n<t;++n)h[l[n]]=d+g.pconfig[l[n]];a.data("extensions")?h.filters[0].extensions=a.data("extensions"):h.filters[0].extensions=null!==b.activeModel?h.filters[0].extensions.replace(/\,zip|\,txt/,""):"zip,txt";d=new window.top.plupload.Uploader(h);d.init();d.bind("FilesAdded",function(a,c){a.refresh();a.start();ThemifyBuilderCommon.showLoader("show")});d.bind("Error",function(a,c){var b=f(".prompt-box .show-error");f(".prompt-box .show-login").hide();b.show();0<b.length&&b.html('<p class="prompt-error">'+
c.message+"</p>");f(".overlay, .prompt-box").fadeIn(500)});d.bind("FileUploaded",function(d,e,g){var k=JSON.parse(g.response);d=f("#themify_builder_alert",top_iframe);g="200"!==g.status||k.error?"error":"done";if(k.error)ThemifyBuilderCommon.showLoader(g),alert(k.error);else if(c){var h=f("#themify_builder_row_wrapper").children().clone(!0);d.promise().done(function(){b.Forms.reLoad(k,themifyBuilder.post_ID);var a=f("#themify_builder_row_wrapper").children().clone(!0);ThemifyBuilderCommon.Lightbox.close();
b.vent.trigger("dom:change","","","","import",{before:h,after:a,bid:themifyBuilder.post_ID})})}else ThemifyBuilderCommon.showLoader(g),g=k.large_url?k.large_url:k.url,a.closest(".themify_builder_input").find(".themify-builder-uploader-input").val(g).trigger("change").parent().find(".img-placeholder").html(f("<img/>",{src:k.thumb,width:50,height:50}))});a.removeClass("plupload-clone")})}},columnDrag:function(a,c,d,g){var e=this;c&&(c=a?a.children(".module_column"):f(".module_column"),c.css("width",
""),e.setCompactMode(c));if(d&&g){a=a.children(".module_column");var k=("gutter-narrow"===d?1.6:"gutter-none"===d?0:3.2)-("gutter-narrow"===g?1.6:"gutter-none"===g?0:3.2),k=parseFloat(k*(a.length-1)/a.length);a.each(function(a){f(this).prop("style").width&&(a=parseFloat(f(this).prop("style").width)+k,f(this).css("width",a+"%"))})}else{var h={"col6-1":14,"col5-1":17.44,"col4-1":22.6,"col4-2":48.4,"col2-1":48.4,"col4-3":74.2,"col3-1":31.2,"col3-2":65.6},l={"col6-1":15.33,"col5-1":18.72,"col4-1":23.8,
"col4-2":49.2,"col2-1":49.2,"col4-3":74.539,"col3-1":32.266,"col3-2":66.05},n={"col6-1":16.666,"col5-1":20,"col4-1":25,"col4-2":50,"col2-1":50,"col4-3":75,"col3-1":33.333,"col3-2":66.666};(a?a.children(".module_column").find(".themify_grid_drag"):f(".themify_grid_drag")).each(function(){var a,c,d,g,k=0,q,x=!1,r=0,z=!1,A,D,C,E;f(this).draggable({axis:"x",cursor:"col-resize",distance:0,scroll:!1,snap:!1,containment:".row_inner",helper:function(b){a=f(b.currentTarget);c=a.closest(".subrow_inner");0===
c.length&&(c=a.closest(".row_inner"));q=a.hasClass("themify_drag_right")?"w":"e";A="w"===q?"themify_grid_drag_placeholder_right":"themify_grid_drag_placeholder_left";z=ThemifyBuilderCommon.Lightbox.clone(c.closest(".module_row"));return f('<div class="ui-widget-header themify_grid_drag_placeholder '+A+'"></div><div class="ui-widget-header themify_grid_drag_placeholder"></div>')},start:function(b,e){d=c.children(".module_column");g=a.closest(".module_column");C=c.hasClass("direction-rtl");"w"===q?
(x=C?g.prev(".module_column"):g.next(".module_column"),k=a.outerWidth()):(x=C?g.next(".module_column"):g.prev(".module_column"),k=g.outerWidth());r=x.outerWidth()-2;E=e.position.left;D=c.outerWidth()},stop:function(a,k){f(".themify_grid_drag_placeholder").remove();var m=Math.ceil(100*(g.outerWidth()/D));g.css("width",m+"%");var p=h,m=3.2;c.hasClass("gutter-narrow")?(p=l,m=1.6):c.hasClass("gutter-none")&&(p=n,m=0);var t=m*(d.length-1);d.each(function(a){a!==x.index()&&(f(this).prop("style").width?
a=parseFloat(f(this).prop("style").width):(a=f.trim(e.filterClass(f(this).attr("class")).replace("first","").replace("last","")),a=p[a]),t+=a)});x.css("width",100-t+"%");x=x.add(g);e.setCompactMode(x);m=c.closest(".module_row");b.vent.trigger("dom:change",m.data("cid"),z,m,"row")},drag:function(a,c){if(x&&0<x.length){var b=k+("e"===q?-c.position.left:c.position.left),d=parseFloat(100*b/D);if(5<=d&&100>d){var f=r+E+("w"===q?-c.position.left:c.position.left),h=parseFloat(100*f/D);5<h&&100>h&&(x.css("width",
f+"px"),g.css("width",b+"px").children("."+A).html(d.toFixed(2)+"%"),g.children(".themify_grid_drag_placeholder").last().html(h.toFixed(2)+"%"),e.setCompactMode(g))}}}})})}},setCompactMode:function(a){a instanceof jQuery&&(a=a.get());for(var c=0,b=a.length;c<b;++c){var f=a[c].clientWidth,f=234>f?["compact-mode-action","compact-mode"]:370>f?["compact-mode"]:"";a[c].classList.remove("compact-mode-action");a[c].classList.remove("compact-mode");if(""!==f)for(var e in f)a[c].classList.add(f[e]);if(""===
f||"compact-mode"===f[0])f=a[c].getElementsByClassName("sub_column"),0<f.length&&this.setCompactMode(f)}},initNewEditor:function(a){var c=tinyMCEPreInit.mceInit.tb_lb_hidden_editor;c.elements=a;c.selector="#"+a;return this.initMCEv4(a,c)},initMCEv4:function(a,c){if(3<parseInt(tinyMCE.majorVersion)){var b=new tinyMCE.Editor(a,c,tinyMCE.EditorManager);b.render();return b}},initQuickTags:function(a){"function"===typeof window.parent.QTags&&(window.parent.quicktags({id:a}),window.parent.QTags._buttonsInit())},
setColorPicker:function(a){f(".minicolors-swatch",a).each(function(){var a=f(this),d=a.closest(".minicolors_wrapper");f(this).one("click",function(){var a=d.find(".minicolors-input");d.prepend(a).find(".minicolors").remove();b.Views.init_control("color",{el:a,binding_type:a.data("control-binding")})}).prev(".minicolors-input").one("focusin",function(){f(this).next(".minicolors-swatch").trigger("click")});d.find(".color_opacity").one("change",function(){a.prev(".minicolors-input").attr("data-opacity",
f(this).val());a.trigger("click")})})},_getColClass:function(a){for(var c=0,b=a.length;c<b;++c)if(-1!==this.gridClass.indexOf(a[c]))return a[c].replace("col","")},saveBuilder:function(a,c,d,g){c=c||"main";d=d||0;0===d&&("main"===c&&b.activeModel&&f(".builder_save_button",top_iframe).trigger("click"),ThemifyBuilderCommon.showLoader("show"));var e=Object.keys(b.Instances.Builder).length,k=b.Instances.Builder[d],h=this,l=k.$el.data("postid"),k=k.toJSON();(function(a,c,d,e){c={action:"tb_save_data",tb_load_nonce:themifyBuilder.tb_load_nonce,
id:a,data:JSON.stringify(c),tb_saveto:d,sourceEditor:"visual"===b.mode?"frontend":"backend"};e&&(c.only_data=e);return f.ajax({type:"POST",url:themifyBuilder.ajaxurl,cache:!1,data:c})})(l,k,c,g).always(function(g,k){++d;e===d?(f.isFunction(a)&&a.call(h,g,k),"success"!==k?ThemifyBuilderCommon.showLoader("error"):(ThemifyBuilderCommon.showLoader("hide"),b.editing=!0,f("body").trigger("themify_builder_save_data",[g,k]))):setTimeout(function(){h.saveBuilder(a,c,d)},50)})},loadContentJs:function(a,c){ThemifyBuilderModuleJs.loadOnAjax(a,
c);if(!1===b.saving){var d=f(".wp-audio-shortcode, .wp-video-shortcode",a).not(".mejs-container").filter(function(){return!f(this).parent().hasClass("mejs-mediaelement")});if(0<d.length){if(themifyBuilder.media_css){for(var g in themifyBuilder.media_css)Themify.LoadCss(themifyBuilder.media_css[g]);themifyBuilder.media_css=null}d.mediaelementplayer("undefined"!==typeof window.top._wpmejsSettings?window.top._wpmejsSettings:{})}}f("body").trigger("builder_load_module_partial",[a,c])},mediaUploader:function(){var a=
{};f("body",top_iframe).on("click",".themify-builder-media-uploader",function(c){c.preventDefault();c.stopPropagation();var b=f(this),g=b.closest(".themify_builder_input");c=b.data("uploader-title");var e=b.data("uploader-button-text"),b=b.data("library-type")?b.data("library-type"):"image",k=Themify.hash(b+c+e);if(void 0!==a[k])var h=a[k];else h=wp.media.frames.file_frame=wp.media({title:c,library:{type:b},button:{text:e},multiple:!1}),a[k]=h;h.off("select").on("select",function(){var a=h.state().get("selection").first().toJSON();
g.find(".themify-builder-uploader-input").val(a.url).trigger("change").parent().find(".img-placeholder").html(f("<img/>",{src:a.url,width:50,height:50}));g.find(".themify-builder-uploader-input-attach-id").val(a.id)});h.open()}).on("click",".themify-builder-delete-thumb",function(a){a.preventDefault();f(this).prev().empty().closest(".themify_builder_input").find(".themify-builder-uploader-input").val("").trigger("change")}).on("click",".insert-media",function(a){window.top.wpActiveEditor=f(this).data("editor")})},
openGallery:function(){var a=wp.media.gallery.shortcode,c=this,b=null;f("body",top_iframe).on("click",".tb-gallery-btn",function(d){d.preventDefault();var e=f(this).closest(".themify_builder_input").find(".tb-shortcode-input");null===b&&(b=wp.media.frames.file_frame=wp.media({frame:"post",state:"gallery-edit",title:wp.media.view.l10n.editGalleryTitle,editing:!0,multiple:!0,selection:!1}),b.$el.addClass("themify_gallery_settings"));wp.media.gallery.shortcode=function(c){var b=c.props.toJSON(),d=_.pick(b,
"orderby","order");c.gallery&&_.extend(d,c.gallery.toJSON());d.ids=c.pluck("id");b.uploadedTo&&(d.id=b.uploadedTo);d._orderbyRandom&&(d.orderby="rand",delete d._orderbyRandom);d.ids&&"post__in"===d.orderby&&delete d.orderby;_.each(wp.media.gallery.defaults,function(a,c){a===d[c]&&delete d[c]});c=new window.top.wp.shortcode({tag:"gallery",attrs:d,type:"single"});e.val(c.string()).trigger("change");wp.media.gallery.shortcode=a;return c};b.on("update",function(a){var b=wp.media.gallery.shortcode(a).string().slice(1,
-1);e.val("["+b+"]");c.setShortcodePreview(a.models,e)});0<f.trim(e.val()).length?(b=wp.media.gallery.edit(f.trim(e.val())),b.state("gallery-edit").on("update",function(a){var b=wp.media.gallery.shortcode(a).string().slice(1,-1);e.val("["+b+"]");c.setShortcodePreview(a.models,e)})):(b.open(),b.$el.find(".media-menu .media-menu-item").last().trigger("click"))})},setShortcodePreview:function(a,c){var b=c.next(".tb_shortcode_preview"),g="";0===b.length&&(b=f('<div class="tb_shortcode_preview"></div>'),
c.after(b));for(var e=0,k=a.length;e<k;++e)var h=a[e].attributes,g=g+('<img src="'+(h.sizes.thumbnail?h.sizes.thumbnail.url:h.url)+'" width="50" height="50" />');b[0].innerHTML=g},createGradientPicker:function(a,c,d){var g=a.closest(".themify-gradient-field"),e=null,k=!1,h=a.data("id"),l=g.find("#"+h+"-gradient-angle"),n=a.prev(),t={angle:l.val(),onChange:function(c,d){k&&(c=d="");"visual"===b.mode&&("cover_gradient"===h||"cover_gradient_hover"===h?b.liveStylingInstance.addOrRemoveComponentOverlay(h,
d):b.liveStylingInstance.bindBackgroundGradient(h,d));a.val(c)},onInit:function(){n.show()}};t.gradient=c?c:a.data("default-gradient")?a.data("default-gradient"):void 0;d||n.ThemifyGradient(t);e=a.prev().data("themifyGradient");c=g.find("#"+h+"-gradient-type");var m=g.find("#"+h+"-circle-radial input"),q=function(a){var c=l.parent(".gradient-angle-knob"),b=g.find("#"+h+"-circle-radial");"radial"===a?(c.hide(),c.next("span").hide(),b.show()):(c.show(),c.next("span").show(),b.hide())};d?(e.settings=
f.extend({},e.settings,t),e.settings.type=c.val(),e.settings.circle=m.is(":checked"),e.isInit=!1,e.update(),e.isInit=!0):(g.find(".themify-clear-gradient").on("click",function(a){a.preventDefault();k=!0;e.settings.gradient=f.ThemifyGradient["default"];e.update();k=!1}),c.on("change",function(a){e.setType(f(this).val());q(f(this).val())}),m.on("change",function(){e.setRadialCircle(f(this).is(":checked"))}),l.on("change",function(){var a=parseInt(f(this).val());a||(a=0);e.setAngle(a)}).knob({change:function(a){e.setAngle(Math.round(a))}}),
l.removeAttr("style").parent().addClass("gradient-angle-knob").find("canvas").insertAfter(l));q(c.val())},toRGBA:function(a){var c=a.split("_"),b=/^([\da-fA-F]{2})([\da-fA-F]{2})([\da-fA-F]{2})$/;return void 0!==c[0]?(b=b.exec(c[0].replace("#","")),c=void 0!==c[1]&&"0.99"!=c[1]?c[1]:1,b?"rgba("+parseInt(b[1],16)+", "+parseInt(b[2],16)+", "+parseInt(b[3],16)+", "+c+")":a):a},getBPWidth:function(a){a=_.isArray(themifyBuilder.breakpoints[a])?themifyBuilder.breakpoints[a]:themifyBuilder.breakpoints[a].toString().split("-");
return a[a.length-1]},transitionPrefix:function(){if(void 0===this.transitionPrefix.pre){var a=document.createElement("fakeelement"),c={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"},b;for(b in c)if(void 0!==a.style[b]){this.transitionPrefix.pre=c[b];break}}return this.transitionPrefix.pre}};_.extend(b.Views.BaseElement.prototype,b.Mixins.Common);_.extend(b.Views.Builder.prototype,b.Mixins.Builder);b.Views.ControlRegistry=
{items:{},register:function(a,c){this.items[a]=c},lookup:function(a){return this.items[a]||null},remove:function(a){delete this.items[a]},destroy:function(){_.each(this.items,function(a,c){a.remove()});this.items={}}};b.Views.Controls["default"]=Backbone.View.extend({initialize:function(a){b.Views.ControlRegistry.register(this.$el.prop("id"),this);a.binding_type&&(this.binding_type=a.binding_type)},preview_element:function(a){if(void 0!==this.binding_type){var c=this.$el.data("control-type"),d="repeater"===
c?this.$el.prop("id"):this.$el.data("control-repeater");d&&"visual"===b.mode?(a=f("#"+d,top_iframe),0<a.length&&(q[d]=b.Forms.parseSettings(a[0]).v)):q[this.$el.prop("id")]=a;"visual"===b.mode?"live"===this.binding_type?b.activeModel.trigger("custom:preview:live",q,"wp_editor"===c||"TEXTAREA"===this.el.tagName):"refresh"===this.binding_type&&b.activeModel.trigger("custom:preview:refresh",q):b.activeModel.backendLivePreview()}}});b.Views.Controls["default"].extend=function(a){var c=this,b=Backbone.View.extend.apply(this,
arguments);b.prototype.events=_.extend({},this.prototype.events,a.events);b.prototype.initialize=function(){_.isFunction(c.prototype.initialize)&&c.prototype.initialize.apply(this,arguments);_.isFunction(a.initialize)&&a.initialize.apply(this,arguments)};return b};b.Views.register_control=function(a,b){"default"!==a&&(this.Controls[a]=this.Controls["default"].extend(b))};b.Views.get_control=function(a){return this.control_exists(a)?this.Controls[a]:this.Controls["default"]};b.Views.control_exists=
function(a){return this.Controls.hasOwnProperty(a)};b.Views.init_control=function(a,c){c=c||{};"wp_editor"===a&&(c.el.hasClass("data_control_binding_live")?c.binding_type="live":c.el.hasClass("data_control_binding_refresh")&&(c.binding_type="refresh"));var d=c.el.data("input-id")?c.el.data("input-id"):c.el.prop("id"),d=this.ControlRegistry.lookup(d);return null!==d?(d.setElement(c.el).render(),d):new (b.Views.get_control(a))(c)};b.Views.register_control("wp_editor",{initialize:function(){this.render()},
render:function(){var a=this,c="refresh"===this.binding_type?1E3:50,d=this.$el.prop("id"),g="",c=_.throttle(function(c){c="setupeditor"===this.type?this.getContent():f(this).val();null!==b.activeModel&&g!==c&&(g=c,!1!==e?a.$el.val(c).trigger("change"):a.preview_element(c))},c);b.Utils.initQuickTags(d);if(void 0!==tinyMCE&&void 0!==this.binding_type){d=b.Utils.initNewEditor(d);var e=this.$el.hasClass("wp-editor-area")?0<this.$el.closest("#instance_widget").length:!1;d.on("change keyup",c)}this.$el.on("change keyup",
c);return this}});b.Views.register_control("change",{initialize:function(){this.render()},render:function(){var a=this,c="refresh"===this.binding_type?1E3:50,b=this.$el.data("control-event");if(void 0===b||""===b)b="change",c=1;this.$el.on(b,_.throttle(function(){a.preview_element(this.value)},c));return this}});b.Views.register_control("query_category",{initialize:function(){this.render()},render:function(){var a=this,b=a.$el.parent(),d=b.find(".query_category_single"),f=b.find(".query_category_multiple");
d.add(f).on("change",function(b){b=f.val()?f.val()+"|multiple":d.val()+"|single";a.preview_element(b)});return this}});b.Views.register_control("layout",{initialize:function(){this.render()},render:function(){var a=this,c=this.$el.data("input-id")?this.$el.data("input-id"):this.$el.prop("id"),d=a.$(".tfl-icon.selected").prop("id");this.$(".tfl-icon").on("click",function(g){g.preventDefault();f(this).addClass("selected").siblings().removeClass("selected");if("visual"===b.mode)if(g=f(this).prop("id"),
"live"===a.binding_type&&void 0!==a.$el.data("control-selector")){var e=b.liveStylingInstance.$liveStyledElmt;""!==a.$el.data("control-selector")&&(e=b.liveStylingInstance.$liveStyledElmt.find(a.$el.data("control-selector")));var k=b.liveStylingInstance.getStylingVal(c);q[c]=g;"layout_feature"===c?(g="layout-"+g,k="layout-"+k):"columns"===c&&(g=c+"-"+g,k=c+"-"+k);!k&&d&&(k=d);e.removeClass(k).addClass(g);"layout_feature"===c?g=g.substr(7):"columns"===c&&(g=g.substr(8));b.liveStylingInstance.setStylingVal(c,
g)}else a.preview_element(g)});return this}});b.Views.register_control("radio",{initialize:function(){this.render()},render:function(){var a=this;this.$('input[type="radio"]').on("change",function(){a.preview_element(this.value)});return this}});b.Views.register_control("checkbox",{initialize:function(){this.render()},render:function(){var a=this;this.$('input[type="checkbox"]').on("click",function(){if(!_.isUndefined(a.binding_type)){var b=a.$('input[type="checkbox"]:checked').map(function(){return this.value}).get();
a.preview_element(b.join("|"))}});return this}});b.Views.register_control("color",{is_typing:!1,initialize:function(){this.render()},render:function(){var a=this,c=this.$el.next(".color_opacity"),d=this.$el.prop("id");this.$el.minicolors({opacity:1,changeDelay:200,beforeShow:function(){var b=ThemifyBuilderCommon.Lightbox.$lightbox,c=a.$el.closest(".minicolors"),d=c.find(".minicolors-panel");d.css("visibility","hidden").show();b.offset().left+b.width()<=d.offset().left+d.width()?c.addClass("tb-minicolors-right"):
c.removeClass("tb-minicolors-right");d.css("visibility","").hide()},change:function(g,e){if(!g||e&&"0.99"==e)e=1;a.is_typing||c.is(":focus")||c.attr("data-opacity",e).data("opacity",e).val(e);var k=g?f(this).minicolors("rgbaString"):"";void 0!==a.binding_type?a.preview_element(k):"visual"===b.mode&&f("body").trigger("themify_builder_color_picker_change",[d,a.$el,g?k:""])}}).minicolors("show");c.on("blur keyup",function(b){var c=parseFloat(f.trim(f(this).val()));if(1<c||isNaN(c)||""===c||0>c)c=a.$el.val()?
1:"","blur"===b.type&&f(this).val(c);f(this).attr("data-opacity",c);a.is_typing="keyup"===b.type;a.$el.minicolors("opacity",c)})}});b.Views.register_control("repeater",{events:{"click .toggle_row":"toggleField","click .themify_builder_duplicate_row":"duplicateRowField","click .themify_builder_delete_row":"deleteRowField"},initialize:function(){this.render()},render:function(){var a=this.$el,b=this,d=!1;a.sortable({items:".tb_repeatable_field",handle:".tb_repeatable_field_top",axis:"y",placeholder:"themify_builder_ui_state_highlight",
tolerance:"pointer",cursor:"move",start:_.debounce(function(b,c){void 0!==tinyMCE&&a.find(".tb_lb_wp_editor").each(function(){var a=f(this).prop("id"),b=tinymce.get(a).getContent();f(this).data("content",b);tinyMCE.execCommand("mceRemoveEditor",!1,a)})},300),stop:_.debounce(function(c,e){void 0!==tinyMCE&&a.find(".tb_lb_wp_editor").each(function(){var a=f(this).prop("id");tinyMCE.execCommand("mceAddEditor",!1,a);tinymce.get(a).setContent(f(this).data("content"))});d&&(e.item.removeClass("collapsed").find(".tb_repeatable_field_content").show(),
d=!1);a.find(".themify_builder_ui_state_highlight").remove();b.preview_element()},300),sort:function(b,c){a.find(".themify_builder_ui_state_highlight").height(30)},beforeStart:function(b,c){c.item.hasClass("collapsed")||(c.item.addClass("collapsed").find(".tb_repeatable_field_content").hide(),d=!0,a.sortable("refresh"))}});return this},toggleField:function(a){a.preventDefault();f(a.currentTarget).closest(".tb_repeatable_field").toggleClass("collapsed").find(".tb_repeatable_field_content").slideToggle()},
duplicateRowField:function(a){a.preventDefault();a.stopPropagation();this.$el.next(".add_new").find("a").trigger("click",f(a.currentTarget).closest(".tb_repeatable_field"));this.preview_element()},deleteRowField:function(a){a.preventDefault();a.stopPropagation();confirm(themifyBuilder.i18n.rowDeleteConfirm)&&(f(a.currentTarget).closest(".tb_repeatable_field").remove(),this.preview_element())}});b.Views.register_control("widget_form",{initialize:function(){this.render()},render:function(){this.$el.on("change",
":input",this._updateWidgetPreview.bind(this));return this},_updateWidgetPreview:function(){this.preview_element(this.$el.find(":input").themifySerializeObject())}})})(jQuery);
